<!doctype html>
<html lang="en">

<head>
    <title>进阶知识-存储过程</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <!-- Javascript -->
    <script type="text/javascript" src="../../../assets/vendor/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/bootstrap/js/bootstrap-paginator.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/bootstrap-select/js/bootstrap-select.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/jquery-slimscroll/jquery.slimscroll.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/echarts/echarts.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/echarts/theme/macarons.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/layer/layer.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/laydate/laydate.js"></script>
    <script type="text/javascript" src="../../../assets/scripts/klorofil-common.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/ui-choose/js/ui-choose.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/highlight/highlight.pack.js"></script>
    <!-- VENDOR CSS -->
    <link rel="stylesheet" href="../../../assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../assets/vendor/bootstrap-select/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="../../../assets/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../assets/vendor/linearicons/style.css">
    <link rel="stylesheet" href="../../../assets/vendor/ui-choose/css/ui-choose.css">
    <link rel="stylesheet" href="../../../assets/vendor/highlight/styles/rainbow.css">
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="../../../assets/css/main.css">
    <!-- CUSTOMIZE CSS -->
    <link rel="stylesheet" href="../../../assets/css/roundButton.css">
    <!-- FOR DEMO PURPOSES ONLY. You should remove this in your project -->
    <link rel="stylesheet" href="../../../assets/css/demo.css">
    <!-- GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet">
    <!-- ICONS -->
    <link rel="apple-touch-icon" sizes="76x76" href="../../../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../../../assets/img/favicon.png">
</head>

<body>
<!-- WRAPPER -->
<div id="wrapper">
    <!-- NAVBAR -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="brand">
            <a href="../../../index.html"><img src="../../../assets/img/logo-KevenPotter.png" alt="KevenPotter Logo" class="img-responsive logo"></a>
        </div>
        <div class="container-fluid">
            <div class="navbar-btn">
                <button type="button" class="btn-toggle-fullwidth"><i class="lnr lnr-arrow-left-circle"></i></button>
            </div>
            <form class="navbar-form navbar-left">
                <div class="input-group">
                    <input type="text" value="" class="form-control" placeholder="搜索内容...">
                    <span class="input-group-btn"><button type="button" class="btn btn-primary">Go</button></span>
                </div>
            </form>
        </div>
    </nav>
    <!-- END NAVBAR -->
    <!-- LEFT SIDEBAR -->
    <div id="sidebar-nav" class="sidebar">
        <div class="sidebar-scroll">
            <nav>
                <ul class="nav">
                    <li><a href="../../../index.html" class=""><i class="lnr lnr-home"></i> <span>首页</span></a></li>
                    <li>
                        <a href="#distributedPage" data-toggle="collapse" class="collapsed"><i class="lnr lnr-cloud"></i> <span>分布式</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                        <div id="distributedPage" class="collapse ">
                            <ul class="nav">
                                <li><a href="../../distributedPage/distributed_overview.html" class="">分布式概述</a></li>
                                <li><a href="../../distributedPage/zookeeper_overview.html" class="">ZooKeeper概述</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="#designPatternsPage" data-toggle="collapse" class="collapsed"><i class="lnr lnr-laptop"></i> <span>设计模式</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                        <div id="designPatternsPage" class="collapse ">
                            <ul class="nav">
                                <li><a href="../../designPatternsPage/six_principles.html" class="">六大原则</a></li>
                                <li><a href="../../designPatternsPage/singleton_pattern.html" class="">单例模式</a></li>
                                <li><a href="../../designPatternsPage/factory_method_pattern.html" class="">工厂方法模式</a></li>
                                <li><a href="../../designPatternsPage/abstract_factory_pattern.html" class="">抽象工厂模式</a></li>
                                <li><a href="../../designPatternsPage/template_method_pattern.html" class="">模板方法模式</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a id="database_page_button" href="#databasePage" data-toggle="collapse" class="collapsed"><i class="lnr lnr-database"></i> <span>数据库</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                        <div id="databasePage" class="collapse ">
                            <ul class="nav">
                                <li><a href="../mysql-basic-knowledge.html" class="">基础知识</a></li>
                                <li>
                                    <a id="database_page_advanced_button" href="#advanced_knowledge" data-toggle="collapse" class="collapsed"><span>进阶知识</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                                    <div id="advanced_knowledge" class="collapse ">
                                        <ul class="nav">
                                            <li><a href="mysql-advanced-knowledge-index.html" class=""><i class="lnr"></i>索引</a></li>
                                            <li><a href="mysql-advanced-knowledge-view.html" class=""><i class="lnr"></i>视图</a></li>
                                            <li><a href="mysql-advanced-knowledge-stored-procedure.html" class="active"><i class="lnr"></i>存储过程</a></li>
                                            <li><a href="mysql-advanced-knowledge-trigger.html" class=""><i class="lnr"></i>触发器</a></li>
                                        </ul>
                                    </div>
                                </li>
                                <li>
                                    <a href="#high_level_knowledge" data-toggle="collapse" class="collapsed"><span>高阶知识</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                                    <div id="high_level_knowledge" class="collapse ">
                                        <ul class="nav">
                                            <li><a href="../mysql-high-level-knowledge/mysql-high-level-knowledge-authority-and-security-management.html" class=""><i class="lnr"></i>权限与安全管理</a></li>
                                            <li><a href="../mysql-high-level-knowledge/mysql-high-level-knowledge-database-backup-and-recovery.html" class=""><i class="lnr"></i>数据库备份与恢复</a></li>
                                            <li><a href="../mysql-high-level-knowledge/mysql-high-level-knowledge-mysql-log-and-performance-optimization.html" class=""><i class="lnr"></i>MySQL日志与性能优化</a></li>
                                        </ul>
                                    </div>
                                </li>
                                <li><a href="../mysql-sub-database_sub-table.html" class="">分库分表</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <!-- END LEFT SIDEBAR -->
    <!-- MAIN -->
    <div class="main">
        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="container-fluid">
                <h3 id="stored_procedure_page_title_tips" class="page-title">存储过程</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel panel-scrolling panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="createStoredProcedureAndFunctionPanelTitleTips()">创建存储过程 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <h4><i class="fa fa-anchor"></i><b>创建存储过程，需要使用CREATE PROCEDURE语句，基本语法格式如下：</b></h4>
                                <code>CREATE PROCEDURE sp_name([proc_parameter]) [characteristics ...] routine_body</code>
                                <hr>
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>关键字</th>
                                        <th>作用</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>CREATE PROCEDURE</td>
                                        <td>为用来创建存储过程的关键字</td>
                                    </tr>
                                    <tr>
                                        <td>sp_name</td>
                                        <td>为存储过程的名称</td>
                                    </tr>
                                    <tr>
                                        <td>proc_parameter</td>
                                        <td class="tinyHand" onclick="createProcedureProcParameterTips()">为指定存储过程的参数列表 <i class="fa fa-hand-pointer-o"></i></td>
                                    </tr>
                                    <tr>
                                        <td>characteristics</td>
                                        <td class="tinyHand" onclick="createProcedureAndFunctionCharacteristicsTips()">指定存储过程的特性 <i class="fa fa-hand-pointer-o"></i></td>
                                    </tr>
                                    <tr>
                                        <td>routine_body</td>
                                        <td>是SQL代码内容，可以用BEGIN...END来表示SQL代码的开始和结束</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例1：</b></h4>
                                <pre>
                                    <code class="sql">
    CREATE PROCEDURE AvgFruitPrice()
    BEGIN
    SELECT AVG(f_price) AS avgPrice
    FROM fruits;
    END;
                                    </code>
                                </pre>
                                <p class="firstLineIndent">上述代码中，此存储过程名为AvgFruitPrice，使用CREATE PROCEDURE AvgFruitPrice()语句定义。此存储过程没有参数，但是后面的()仍然需要。BEGIN和END语句用来限定存储过程体，过程本身仅是一个简单的SELECT语句</p>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例2：</b></h4>
                                <pre>
                                    <code class="sql">
    mysql> DELIMITER //
    mysql> CREATE PROCEDURE Proc()
    mysql> BEGIN
    mysql> SELECT * FROM fruits;
    mysql> END; //
    Query OK, 0 rows affected (0.00 sec)
    mysql> DELIMITER ;
                                    </code>
                                </pre>
                                <p class="firstLineIndent">这行代码创建了一个查看fruits表的存储过程，每次调用这个存储过程的时候都会执行SELECT语句查看表的内容</p>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例3：</b></h4>
                                <pre>
                                    <code class="sql">
    mysql> DELIMITER //
    mysql> CREATE PROCEDURE CountProc(OUT param1 INT)
    mysql> BEGIN
    mysql> SELECT COUNT(*) INTO param1 FROM fruits;
    mysql> END; //
    Query OK, 0 rows affected (0.00 sec)
    mysql> DELIMITER ;
                                    </code>
                                </pre>
                                <p class="firstLineIndent">上述代码的作用是创建一个获取fruits表记录条数的存储过程，名称是CountProc，COUNT(*)计算后把结果放入参数param1中</p>
                                <hr>
                                <h4><i class="fa fa-anchor"></i><b>DELIMITER：</b></h4>
                                <p class="firstLineIndent">“DELIMITER //”语句的作用是将MySQL的结束符设置为//，因为MySQL默认的语句结束符号为封号‘;’。为了避免与存储过程中SQL语句结束符相冲突，需要使用DELIMITER改变存储过程的结束符，并以“END //”结束存储过程。存储过程定义完毕之后再使用“DELIMITER ;”恢复默认结束符。DELIMITER也可以指定其他符号作为结束符。</p>
                                <p class="firstLineIndent"><b>当使用DELIMITER命令时，应该避免使用反斜杠（‘/’）字符，因为反斜线是MySQL的转义字符。</b></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-scrolling panel-warning">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="createStoredProcedureAndFunctionPanelTitleTips()">创建存储函数 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <h4><i class="fa fa-anchor"></i><b>创建存储过程，需要使用CREATE FUNCTION语句，基本语法格式如下：</b></h4>
                                <code>CREATE FUNCTION func_name ([func_parameter]) RETURNS TYPE [characteristic ...] routine_body</code>
                                <hr>
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>关键字</th>
                                        <th>作用</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>CREATE FUNCTION</td>
                                        <td>为用来创建存储函数的关键字</td>
                                    </tr>
                                    <tr>
                                        <td>func_name</td>
                                        <td>为存储函数的名称</td>
                                    </tr>
                                    <tr>
                                        <td>func_parameter</td>
                                        <td class="tinyHand" onclick="createFunctionFuncParameterTips()">为指定存储函数的参数列表 <i class="fa fa-hand-pointer-o"></i></td>
                                    </tr>
                                    <tr>
                                        <td>RETURNS TYPE</td>
                                        <td>表示函数返回数据的类型</td>
                                    </tr>
                                    <tr>
                                        <td>characteristics</td>
                                        <td class="tinyHand" onclick="createProcedureAndFunctionCharacteristicsTips()">指定存储函数的特性 <i class="fa fa-hand-pointer-o"></i></td>
                                    </tr>
                                    <tr>
                                        <td>routine_body</td>
                                        <td>是SQL代码内容，可以用BEGIN...END来表示SQL代码的开始和结束</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例1：</b></h4>
                                <pre>
                                    <code class="sql">
    mysql> DELIMITER //
    mysql> CREATE FUNCTION NameByZip()
    mysql> RETURNS CHAR(50)
    mysql> RETURN (SELECT s_name FROM suppliers WHERE s_call = '48075');
    mysql> //
    Query OK, 0 rows affected (0.12 sec)
    mysql> DELIMITER ;
                                    </code>
                                </pre>
                                <p class="firstLineIndent">如果在存储函数中的RETURN语句返回一个类型不同于函数的RETURNS子句中指定类型的值，返回值将被强制为恰当的类型。比如，如果一个函数返回一个ENUM或SET值，但是RETURN语句返回一个整数，对于SET成员集相应的ENUM成员，从函数返回的值是字符串。</p>
                                <p class="firstLineIndent"><span class="note">提示</span>：指定参数为IN、OUT或INOUT只对PROCEDURE是合法的（FUNCTION中总是默认为IN参数）。RETURNS子句只能对FUNCTION做指定，对函数而言这是强制的。它用来指定函数的返回类型，而且函数体必须包含一个RETURN value语句。</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel panel-scrolling panel-info">
                            <div class="panel-heading">
                                <h3 class="panel-title">变量的使用</h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <p class="firstLineIndent"><b>变量</b>可以在子程序中声明并使用，这些变量的作用范围是在<span class="note">BEGIN...END</span>程序中</p>
                                <h4><i class="fa fa-anchor"></i><b>定义变量：</b></h4>
                                <code>DECLARE var_name [,var_name]... DATA_TYPE [DEFAULT value];</code>
                                <hr>
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>关键字</th>
                                        <th>作用</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>var_name</td>
                                        <td>为局部变量的名称</td>
                                    </tr>
                                    <tr>
                                        <td>DEFAULT value</td>
                                        <td>给变量提供一个默认值。值除了可以被声明为一个常数外，还可以被指定为一个表达式。如果没有DEFAULT子句，初始值为NULL</td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            定义名称为myParam的变量，类型为INT类型，默认值为100：<code>DECLARE myParam INT DEFAULT 100;</code>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <hr>
                                <h4><i class="fa fa-anchor"></i><b>变量赋值：</b></h4>
                                <code class="tinyHand" onclick="variableAssignmentSetTips()">SET var_name = expr [,var_name = expr] ...; </code><i class="fa fa-hand-pointer-o"></i>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例1：</b></h4>
                                <p class="firstLineIndent">声明3个变量，分别为var1、var2和var3，数据类型为INT，使用SET为变量赋值，代码如下：</p>
                                <pre>
                                    <code class="sql">
    DECLARE var1, var2, var3 INT;
    SET var1 = 10, var2 = 20;
    SET var3 = var1 + var2;
                                    </code>
                                </pre>
                                <hr>
                                <h4><i class="fa fa-anchor"></i><b>SELECT...INTO语法：</b></h4>
                                <p class="firstLineIndent">在MySQL中，还可以通过SELECT...INTO为一个或多个变量赋值。SELECT语法把选定的列直接存储到对应位置的变量。语法如下：</p>
                                <code>SELECT col_name[,...] INTO var_name[,...] table_expr;</code>
                                <hr>
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>关键字</th>
                                        <th>作用</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>col_name</td>
                                        <td>表示字段名称</td>
                                    </tr>
                                    <tr>
                                        <td>var_name</td>
                                        <td>表示定义的变量名称</td>
                                    </tr>
                                    <tr>
                                        <td>table_expr</td>
                                        <td>表示查询条件表达式，包括表名称和WHERE子句</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例1：</b></h4>
                                <p class="firstLineIndent">声明3个变量，分别为var1、var2和var3，数据类型为INT，使用SET为变量赋值，代码如下：</p>
                                <pre>
                                    <code class="sql">
    -- 声明变量fruitName和fruitPrice，通过SELECT...INTO语句查询指定记录并为变量赋值：
    DECLARE fruitName CHAR(50);
    DECLARE fruitPrice DECIMAL(8,2);
    SELECT f_name,f_price INTO fruitName,fruitPrice
    FROM fruits WHERE f_id = 'a1';
                                    </code>
                                </pre>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-scrolling panel-danger">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="defineConditionsAndProcessingProceduresTips()">定义条件和处理程序 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <h4><i class="fa fa-anchor"></i><b>定义条件</b></h4>
                                <p class="firstLineIndent">定义条件使用DECLARE语句，语法格式如下：</p>
                                <code>DECLARE condition_name CONDITION FOR [CONDITION_TYPE]</code>
                                <hr>
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>关键字</th>
                                        <th>作用</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>condition_name</td>
                                        <td>表示条件的名称</td>
                                    </tr>
                                    <tr>
                                        <td>CONDITION_TYPE</td>
                                        <td class="tinyHand" onclick="defineConditionsConditionTypeTips()">表示条件的类型 <i class="fa fa-hand-pointer-o"></i></td>
                                    </tr>
                                    </tbody>
                                </table>
                                <p class="firstLineIndent">上述语句指定需要特殊处理的条件。它将一个名字和指定的错误条件关联起来。这个名字可以随后被用在定义处理程序的<span class="bold note">DECLARE HANDLER</span>语句中。</p>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例1：</b></h4>
                                <p class="firstLineIndent">定义"ERROR 1148(42000)"错误，名称为command_not_allowed：</p>
                                <pre>
                                    <code class="sql">
    -- 方法一：使用sqlstate_value
    DECLARE command_not_allowed CONDITION FOR SQLSTATE '42000';
    -- 方法二：使用mysql_error_code
    DECLARE command_not_allowed CONDITION FOR 1148;
                                    </code>
                                </pre>
                                <hr>
                                <h4><i class="fa fa-anchor"></i><b>定义处理程序</b></h4>
                                <p class="firstLineIndent">定义处理程序时，使用DECLARE语句的语法如下：</p>
                                <code>DECLARE handler_type HANDLER FOR condition_value[,...] sp_statement;</code>
                                <hr>
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>关键字</th>
                                        <th>作用</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>handler_type</td>
                                        <td class="tinyHand" onclick="defineHandlerHandlerTypeTips()">为错误处理方式 <i class="fa fa-hand-pointer-o"></i></td>
                                    </tr>
                                    <tr>
                                        <td>condition_value</td>
                                        <td class="tinyHand" onclick="defineHandlerConditionValueTips()">表示错误类型 <i class="fa fa-hand-pointer-o"></i></td>
                                    </tr>
                                    <tr>
                                        <td>sp_statement</td>
                                        <td>为程序语句段，表示在遇到定义的错误时需要执行的存储过程或函数</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例1：</b></h4>
                                <p class="firstLineIndent">定义处理程序的几种方式，代码如下：</p>
                                <pre>
                                    <code class="sql">
    -- 方法一：捕获sqlstate_value
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42S02' SET @info='NO_SUCH_TABLE';

    -- 方法二：捕获mysql_error_code
    DECLARE CONTINUE HANDLER FOR 1146 SET @info='NO_SUCH_TABLE';

    -- 方法三：先定义条件，然后调用
    DECLARE no_such_table CONDITION FOR 1146;
    DECLARE CONTINUE HANDLER FOR no_such_table SET @info='NO_SUCH_TABLE'

    -- 方法四：使用SQLWARNING
    DECLARE EXIT HANDLER FOR SQLWARNING SET @info='ERROR'

    -- 方法五：使用NOT FOUND
    DECLARE EXIT HANDLER FOR NOT FOUND SET @info='NO_SUCH_TABLE';

    -- 方法六：使用SQLEXCEPTION
    DECLARE EXIT HANDLER FOR SQLEXCEPTION SET @info='ERROR';
                                    </code>
                                </pre>
                                <table class="table table-hover">
                                    <tbody>
                                    <tr>
                                        <td>第一种方法是捕获sqlstate_value值。如果遇到sqlstate_value值为“42S02”，执行CONTINUE操作，并且输出“NO_SUCH_TABLE”信息</td>
                                    </tr>
                                    <tr>
                                        <td>第二种方法是捕获mysql_error_code值。如果遇到mysql_error_code值为1146，执行CONTINUE操作，并且输出“NO_SUCH_TABLE”信息</td>
                                    </tr>
                                    <tr>
                                        <td>第三种方法是先定义条件，再调用条件。这里先定义no_such_table条件，遇到1146错误就执行CONTINUE操作</td>
                                    </tr>
                                    <tr>
                                        <td>第四种方法是使用SQLWARNING。SQLWARNING捕获所有以01开头的sqlstate_value值，然后执行EXIT操作，并且输出“ERROR”信息</td>
                                    </tr>
                                    <tr>
                                        <td>第五种方法是使用NOT FOUND。NOT FOUND捕获所有以02开头的sqlstate_value值，然后执行EXIT操作，并且输出“NO_SUCH_TABLE”信息</td>
                                    </tr>
                                    <tr>
                                        <td>第六种方法是使用SQLEXCEPTION。SQLEXCEPTION捕获所有没有被SQLWARNING或NOT FOUND捕获的sqlstate_value值，然后执行EXIT操作，并且输出“ERROR”信息</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例2：</b></h4>
                                <p class="firstLineIndent">定义条件和处理程序，代码如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> CREATE TABLE text_db.t (s1 int,primary key(s1));
    Query OK, 0 rows affected (0.00 sec)

    mysql> DELIMITER //
    mysql> CREATE PROCEDURE handlerDemo()
        -> BEGIN
        -> DECLARE CONTINUE HANDLER FOR SQLSTATE '23000' SET @x2 = 1;
        -> SET @x = 1;
        -> INSERT INTO test_db.t VALUES(1);
        -> SET @x = 2;
        -> INSERT INTO test_db.t VALUES(1);
        -> SET @x = 3;
        -> END;
        -> //
    Query OK, 0 rows affected (0.00 sec)

    mysql> DELIMITER ;
    mysql> CALL handlerDemo();
    Query OK, 0 rows affected (0.00 sec)

    mysql> SELECT @x;
    +-----+
    | @x  |
    +-----+
    |  3  |
    +-----+
                                    </code>
                                </pre>
                                <p class="firstLineIndent"><b>@x</b>是一个用户变量，执行结果@x等于3，这表明MySQL被执行到程序的末尾。如果<code>DECLARE CONTINUE HANDLER FOR SQLSTATE '23000' SET @x2 = 1;</code>这一行不存在，第二个INSERT因PRIMARY KEY强制而失败之后，MySQL可能已经采取默认（EXIT）路径，并且SELECT @x 可能已经返回2。</p>
                                <p class="firstLineIndent"><b>@var_name</b>表示用户变量，使用SET语句为其赋值，用户变量与连接有关，一个客户端定义的变量不能被其他客户端看到或使用。当客户端退出时，该客户端连接的所有变量将自动释放。</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel panel-scrolling panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="useOfTheCursorTips()">光标的使用 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <h4><i class="fa fa-anchor"></i><b>声明光标：</b></h4>
                                <p class="firstLineIndent">在MySQL中，使用DECLARE关键字来声明光标，其语法的基本形式如下：</p>
                                <code>DECLARE cursor_name CURSOR FOR select_statement;</code>
                                <hr>
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>关键字</th>
                                        <th>作用</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>cursor_name</td>
                                        <td>表示光标的名称</td>
                                    </tr>
                                    <tr>
                                        <td>select_statement</td>
                                        <td>表示SELECT语句的内容，返回一个用于创建光标的结果集</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例1：</b></h4>
                                <p class="firstLineIndent">声明名称为cursor_fruit的光标，代码如下：</p>
                                <pre>
                                    <code class="sql">
    DECLARE cursor_fruit CURSOR FOR SELECT f_name, f_price FROM fruits;
                                    </code>
                                </pre>
                                <p class="firstLineIndent">在上面的示例中，光标的名称为cursor_fruit，SELECT语句部分从fruits表中查询出f_name和f_price字段的值。</p>
                                <hr>
                                <h4><i class="fa fa-anchor"></i><b>打开光标：</b></h4>
                                <p class="firstLineIndent">打开光标的语法如下：</p>
                                <code>OPEN cursor_name;</code>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例1：</b></h4>
                                <p class="firstLineIndent">打开名称为cursor_fruit的光标，代码如下：</p>
                                <pre>
                                    <code class="sql">
    OPEN cursor_fruit;
                                    </code>
                                </pre>
                                <hr>
                                <h4><i class="fa fa-anchor"></i><b>使用光标：</b></h4>
                                <p class="firstLineIndent">使用光标的语法如下：</p>
                                <code>FETCH cursor_name INTO var_name [,var_name] ...;</code>
                                <hr>
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>关键字</th>
                                        <th>作用</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>cursor_name</td>
                                        <td>表示光标的名称</td>
                                    </tr>
                                    <tr>
                                        <td>var_name</td>
                                        <td>表示将光标中的SELECT语句查询出来的信息存入该参数中，var_name必须在声明光标之前就定义好。</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例1：</b></h4>
                                <p class="firstLineIndent">使用名称为cursor_fruit的光标将查询出来的数据存入fruit_name和fruit_price这两个变量中，代码如下：</p>
                                <pre>
                                    <code class="sql">
    FETCH cursor_fruit INTO fruit_name, fruit_price;
                                    </code>
                                </pre>
                                <hr>
                                <h4><i class="fa fa-anchor"></i><b>关闭光标：</b></h4>
                                <p class="firstLineIndent">关闭光标的语法如下：</p>
                                <code>CLOSE cursor_name;</code>
                                <p class="firstLineIndent">这个语句关闭先前打开的光标，如果未被明确地关闭，光标在它被声明的复合语句的末尾关闭。</p>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例1：</b></h4>
                                <p class="firstLineIndent">关闭名称为cursor_fruit的光标，代码如下：</p>
                                <pre>
                                    <code class="sql">
    CLOSE cursor_fruit;
                                    </code>
                                </pre>
                                <p class="firstLineIndent"><span class="bold note">注意：MySQL中光标只能在存储过程和函数中使用。</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-success">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="useOfProcessControlTips()">流程控制的使用 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div id="use_of_process_control" style="height:400%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel panel-scrolling panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="callStoredProceduresAndFunctionsTips()">调用存储过程和函数 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <h4><i class="fa fa-anchor"></i><b>调用存储过程：</b></h4>
                                <p class="firstLineIndent">存储过程是通过CALL语句进行调用的，CALL语句调用一个先前用CREATE PROCEDURE创建的存储过程。语法如下：</p>
                                <p class="firstLineIndent"><code>CALL sp_name([parameter[,...]])</code></p>
                                <hr>
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>关键字</th>
                                        <th>作用</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>sp_name</td>
                                        <td>为存储过程名称</td>
                                    </tr>
                                    <tr>
                                        <td>parameter</td>
                                        <td>为存储过程的参数</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                                <p class="firstLineIndent">定义名为CountProc1的存储过程，然后调用这个存储过程。代码如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> use test_db;
    mysql> DELIMITER //
    mysql> CREATE PROCEDURE CountProc1 (IN sid INT,OUT num INT)
        -> BEGIN
        -> SELECT COUNT(*) INTO num FROM fruits WHERE s_id = sid;
        -> END //
    Query OK, 0 rows affected (0.00 sec)
    mysql>
    mysql>
    mysql> DELIMITER ;
    mysql>
    mysql>
    mysql> CALL CountProc1(101,@num);
    Query OK, 1 rows affected (0.00 sec)
    mysql>
    mysql>
    mysql> SELECT @num;
    +-------+
    | @num  |
    +-------+
    |   3   |
    +-------+
                                    </code>
                                </pre>
                                <p class="firstLineIndent">该存储过程返回了指定s_id=101的水果商提供的水果种类，返回值存储在num变量中，使用SELECT查看，返回结果为3。</p>
                                <hr>
                                <h4><i class="fa fa-anchor"></i><b>调用存储函数：</b></h4>
                                <p class="firstLineIndent">在MySQL中，存储函数的使用方法与MySQL内部函数的使用方法是一样的。换言之，用户自己定义的存储函数与MySQL内部函数是一个性质的。区别在于，存储函数是用户自己定义的，而内部函数是MySQL的开发者定义的。</p>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                                <p class="firstLineIndent">定义存储函数CountProc2，然后调用这个存储函数。代码如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> DELIMITER //
    mysql> CREATE FUNCTION CountProc2 (sid INT)
        -> RETURNS INT
        -> BEGIN
        -> RETURN (SELECT COUNT(*) FROM fruits WHERE s_id = sid);
        -> END; //
    Query OK, 0 rows affected (0.00 sec)
    mysql> DELIMITER ;
    mysql>
    mysql>
    mysql> SELECT CountProc2(101);
    mysql> SELECT @num;
    +------------------+
    | CountProc2(101)  |
    +------------------+
    |         3        |
    +------------------+
    Query OK, 1 rows in set (0.00 sec)
                                    </code>
                                </pre>
                                <p class="firstLineIndent">可以看到，该例与上一个例子中返回的结果相同。虽然存储函数和存储过程的定义稍有不同，但可以实现相同的功能。</p>
                                <p class="firstLineIndent"><span class="bold note">注意</span>：如果在创建存储函数中报错<code>“you *might* want to usre the less safe log_bin_trust_function_creators variable”</code>，需要执行以下代码：</p>
                                <pre>
                                    <code class="sql">
    mysql> SET GLOBAL log_bin_trust_function_creators = 1;
                                    </code>
                                </pre>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-warning">
                            <div class="panel-heading">
                                <h3 class="panel-title">查看存储过程和函数</h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div id="view_stored_procedures_and_functions" style="height:400%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel panel-scrolling panel-info">
                            <div class="panel-heading">
                                <h3 class="panel-title">修改存储过程和函数</h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <p class="firstLineIndent">使用<code>ALTER</code>语句可以修改存储过程或存储函数的特性。语法如下：</p>
                                <p class="firstLineIndent"><code>ALTER {PROCEDURE | FUNCTION} sp_name [characteristic ...]</code></p>
                                <hr>
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>关键字</th>
                                        <th>作用</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>sp_name</td>
                                        <td>表示存储过程或存储函数的名称</td>
                                    </tr>
                                    <tr>
                                        <td>characteristic</td>
                                        <td class="tinyHand" onclick="modifyAStoredProcedureOrFunctionCharacteristicsTips()">指定存储函数的特性 <i class="fa fa-hand-pointer-o"></i></td>
                                    </tr>
                                    </tbody>
                                </table>
                                <p class="firstLineIndent">修改存储过程使用<code>ALTER PROCEDURE</code>语句，修改存储函数使用<code>ALTER FUNCTION</code>语句。但是，这两个语句的结构是一样的，语句中的所有参数也是一样的。而且，它们与创建存储过程或存储函数的语句中的参数也是基本一样的。</p>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例1：</b></h4>
                                <p class="firstLineIndent">修改存储过程CountProc的定义。将读写权限改为MODIFIES SQL DATA，并指明调用者可以执行。代码如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> ALTER PROCEDURE CountProc
        -> MODIFIES SQL DATA
        -> SQL SECURITY INVOKER;
    Query OK, 0 rows affected (0.00 sec)
    mysql>
    mysql>
    mysql> SELECT SPECIFIC_NAME,SQL_DATA_ACCESS,SECURITY_TYPE
        -> FROM information_schema.Routines
        -> WHERE ROUTINE_NAME = 'CountProc' AND ROUTINE_TYPE = 'PROCEDURE';
    +---------------+-----------------------+-----------------+
    | SPECIFIC_NAME |    SQL_DATA_ACCESS    |  SECURITY_TYPE  |
    +---------------+-----------------------+-----------------+
    |   CountProc   |    MODIFIES SQL DATA  |     INVOKER     |
    +---------------+-----------------------+-----------------+
                                    </code>
                                </pre>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例2：</b></h4>
                                <p class="firstLineIndent">修改存储函数CountProc的定义。将读写权限改为READS SQL DATA，并加上注释信息“FIND NAME”。代码如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> ALTER FUNCTION CountProc
        -> READS SQL DATA
        -> COMMENT 'FIND NAME';
    Query OK, 0 rows affected (0.00 sec)
    mysql>
    mysql>
    mysql> SELECT SPECIFIC_NAME,SQL_DATA_ACCESS,ROUTINE_COMMENT
        -> FROM information_schema.Routines
        -> WHERE ROUTINE_NAME = 'CountProc' AND ROUTINE_TYPE = 'FUNCTION';
    +---------------+---------------------+-------------------+
    | SPECIFIC_NAME |    SQL_DATA_ACCESS  |  ROUTINE_COMMENT  |
    +---------------+---------------------+-------------------+
    |   CountProc   |    READS SQL DATA   |     FIND NAME     |
    +---------------+---------------------+-------------------+
                                    </code>
                                </pre>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-scrolling panel-danger">
                            <div class="panel-heading">
                                <h3 class="panel-title">删除存储过程和函数（后续带有MySQL8.0新特性——全局变量的持久化）</h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <h4><i class="fa fa-anchor"></i><b>删除存储过程和函数：</b></h4>
                                <p class="firstLineIndent">使用<code>DROP</code>语句可以删除存储过程或存储函数。这个语句被用来移除一个存储过程或存储函数。语法如下：</p>
                                <p class="firstLineIndent"><code>DROP {PROCEDURE | FUNCTION} [IF EXISTS] sp_name</code></p>
                                <hr>
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>关键字</th>
                                        <th>作用</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>sp_name</td>
                                        <td>为要移除的存储过程或存储函数的名称</td>
                                    </tr>
                                    <tr>
                                        <td>IF EXISTS</td>
                                        <td>是一个MySQL的扩展。如果程序或函数不存储，它可以防止发生错误，产生一个用<code>SHOW WARNINGS</code>查看的警告</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                                <p class="firstLineIndent">删除存储过程和存储函数。代码如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> DROP PROCEDURE CountProc;
    Query OK, 0 rows affected (0.00 sec)
    mysql> DROP FUNCTION CountProc;
    Query OK, 0 rows affected (0.00 sec)
                                    </code>
                                </pre>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例2：</b></h4>
                                <p class="firstLineIndent">修改存储函数CountProc的定义。将读写权限改为READS SQL DATA，并加上注释信息“FIND NAME”。代码如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> ALTER FUNCTION CountProc
        -> READS SQL DATA
        -> COMMENT 'FIND NAME';
    Query OK, 0 rows affected (0.00 sec)
    mysql>
    mysql>
    mysql> SELECT SPECIFIC_NAME,SQL_DATA_ACCESS,ROUTINE_COMMENT
        -> FROM information_schema.Routines
        -> WHERE ROUTINE_NAME = 'CountProc' AND ROUTINE_TYPE = 'FUNCTION';
    +---------------+---------------------+-------------------+
    | SPECIFIC_NAME |    SQL_DATA_ACCESS  |  ROUTINE_COMMENT  |
    +---------------+---------------------+-------------------+
    |   CountProc   |    READS SQL DATA   |     FIND NAME     |
    +---------------+---------------------+-------------------+
                                    </code>
                                </pre>
                                <hr>
                                <h4><i class="fa fa-anchor"></i><b>全局变量的持久化：</b></h4>
                                <p class="firstLineIndent">在MySQL数据库中，全局变量可以通过<code>SET GLOBAL</code>语句来设置。例如，设置服务器语句超时的限制，可以通过设置系统变量<code>max_execution_time</code>来实现：</p>
                                <p class="firstLineIndent"><code>SET GLOBAL max_execution_time = 2000;</code></p>
                                <p class="firstLineIndent">使用<code>SET GLOBAL</code>语句设置的变量值只会临时生效。<span class="note">数据库重启后，服务器又会从MySQL配置文件中读取变量的默认值。</span></p>
                                <p class="firstLineIndent">MySQL8.0版本新增了<code>SET PERSIST</code>命令。例如，设置服务器的最大连接数1000：</p>
                                <p class="firstLineIndent"><code>SET PERSIST max_connections = 1000;</code></p>
                                <p class="firstLineIndent">MySQL会将该命令的配置保存到数据目录下的mysqld-auto.cnf文件中，下次启动时会读取该文件，用其中的配置来覆盖默认的配置文件。</p>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                                <p class="firstLineIndent">查看并修改全局变量max_connections的值。在代码<code>SET PERSIST max_connections = 1000;</code>之后需要重启MySQL服务器，再次查询max_connections的值。代码如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> SHOW variables LIKE '%max_connections%';
    +--------------------------+---------+
    |        Variable_name     |  Value  |
    +--------------------------+---------+
    |       max_connections    |   151   |
    +--------------------------+---------+
    |   mysqlx_max_connections |   100   |
    +--------------------------+---------+
    mysql>
    mysql> SET PERSIST max_connections = 1000;
    Query OK, 0 rows affected (0.00 sec)
    mysql>
    mysql>
    mysql> SHOW variables LIKE '%max_connections%';
    +--------------------------+----------+
    |        Variable_name     |  Value   |
    +--------------------------+----------+
    |       max_connections    |   1000   |
    +--------------------------+----------+
    |   mysqlx_max_connections |   100    |
    +--------------------------+----------+
                                    </code>
                                </pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END MAIN CONTENT -->
    </div>
    <!-- END MAIN -->
    <div class="clearfix"></div>
    <footer>
        <div class="container-fluid">
            <p class="copyright">Copyright &copy; https://github.com/KevenPotter/KevenPotterInterview <a href="https://github.com/KevenPotter/KevenPotterInterview" target="_blank" title="KevenPotter">KevenPotter</a> - Collect from <a href="https://github.com/KevenPotter" title="Github"
                                                                                                                                                                                                                                          target="_blank">KevenPotter主页</a></p>
        </div>
    </footer>
</div>
<!-- END WRAPPER -->

<!-- 创建存储过程和函数的提示 -->
<div id="create_stored_procedure_and_function_panel_title_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">创建存储过程和函数</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            存储程序可以分为<span class="note">存储过程</span>和<span class="note">存储函数</span>。在MySQL中，创建存储过程和函数使用的语句分别是<code>CREATE PROCEDURE</code>和<code>CREATE FUNCTION</code>。使用<code>CALL</code>语句来调用存储过程，只能用输出变量返回值。存储函数可以从语句外调用（引用函数名），也能返回标量值。存储过程也可以调用其他存储过程。
        </p>
    </div>
</div>

<!-- 创建存储过程-proc_parameter提示 -->
<div id="create_procedure_proc_parameter_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">proc_parameter形式</h3>
    </div>
    <div class="panel-body">
        <code>[ IN | OUT | INOUT ] param_name TYPE</code>
        <hr>
        <table class="table table-hover">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>[ IN | OUT | INOUT ]</td>
                <td>分别表示输入参数、输出参数、输入输出参数</td>
            </tr>
            <tr>
                <td>param_name</td>
                <td>参数名称</td>
            </tr>
            <tr>
                <td>TYPE</td>
                <td>参数类型，该类型可以是MySQL数据库中的任意类型</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- 创建存储过程-characteristics提示 -->
<div id="create_procedure_and_function_characteristics_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">characteristics形式</h3>
    </div>
    <div class="panel-body">
        <table class="table table-hover">
            <thead>
            <tr>
                <th>特性</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>LANGUAGE SQL</td>
                <td>说明routine_body部分是由SQL语句组成的，当前系统支持的语言为SQL。SQL是LANGUAGE特性的唯一值</td>
            </tr>
            <tr>
                <td>[NOT] DETERMINISTIC</td>
                <td>
                    指明存储过程执行的结果是否正确。
                    <ul>
                        <li>DETERMINISTIC表示结果是确定的。每次执行存储过程时，相同的输入会得到相同的输出</li>
                        <li>NOT DETERMINISTIC表示结果是不确定的，相同的输入可能得到不同的输出</li>
                    </ul>
                    如果没有指定任意一个值，默认为NOT DETERMINISTIC
                </td>
            </tr>
            <tr>
                <td>
                    &nbsp;<br/>
                    {CONTAINS SQL}<br/>
                    {NO SQL}<br/>
                    {READS SQL DATA}<br/>
                    {MODIFIES SQL DATA}
                </td>
                <td>
                    指明子程序使用SQL语句的限制。默认情况下，系统会指定为CONTAINS SQL
                    <ul>
                        <li>CONTAINS SQL：表明子程序包含SQL语句，但是不包含读写数据的语句</li>
                        <li>NO SQL：表明子程序不包含SQL语句</li>
                        <li>READS SQL DATA：表明子程序包含读数据的语句</li>
                        <li>MODIFIES SQL DATA：表明子程序包含写数据的语句</li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td>
                    &nbsp;<br/>
                    SQL SECURITY {DEFINER}<br/>
                    SQL SECURITY {INVOKER}
                </td>
                <td>
                    指明谁有权限来执行。默认情况下，系统指定为DEFINER
                    <ul>
                        <li>DEFINER表示只有定义者才能执行</li>
                        <li>INVOKER表示拥有权限的调用者可以执行</li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td>COMMENT 'string'</td>
                <td>注释信息，可以用来描述存储过程或函数</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- 创建存储函数-func_parameter提示 -->
<div id="create_function_func_parameter_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">func_parameter形式</h3>
    </div>
    <div class="panel-body">
        <code>[ IN | OUT | INOUT ] param_name TYPE</code>
        <hr>
        <table class="table table-hover">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>[ IN | OUT | INOUT ]</td>
                <td>分别表示输入参数、输出参数、输入输出参数</td>
            </tr>
            <tr>
                <td>param_name</td>
                <td>参数名称</td>
            </tr>
            <tr>
                <td>TYPE</td>
                <td>参数类型，该类型可以是MySQL数据库中的任意类型</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- 变量赋值提示 -->
<div id="variable_assignment_set_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">SET语句</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">在存储程序中的SET语句是一般SET语句的扩展版本。被参考变量可能是<b>子程序内声明的变量</b>，或者是<b>全局服务器变量</b>，如系统变量或者用户变量。</p>
        <p class="firstLineIndent">在存储程序中的SET语句作为预先存在的SET语法的一部分来实现，允许<code>SET a=x,b=y,...</code>这样的扩展语法。其中，不同的变量类型（局域变量和全局变量）可以被混合起来。这也允许把局部变量和一些只对系统变量有意义的选项合并起来。</p>
    </div>
</div>

<!-- 定义条件和处理程序提示 -->
<div id="define_conditions_and_processing_procedures_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">定义条件和处理程序</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent"><span class="note">特定条件需要特定处理</span>。这些条件可以联系到错误以及子程序中的一般流程控制。</p>
        <p class="firstLineIndent"><span class="note">定义条件</span>是事先定义程序执行过程中遇到的问题。</p>
        <p class="firstLineIndent"><span class="note">处理程序</span>定义了在遇到这些问题时应当采取的处理方式，并且保证存储过程或函数在遇到警告或错误时能继续执行。</p>
        <p class="firstLineIndent">这样可以增强存储程序处理问题的能力，避免程序异常停止运行。</p>
    </div>
</div>

<!-- 定义条件-condition_type提示 -->
<div id="define_conditions_condition_type_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">condition_type</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">sqlstate_value和mysql_error_code都可以表示MySQL的错误：</p>
        <table class="table table-hover">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>SQLSTATE [VALUE] sqlstate_value</td>
                <td>为长度为5的字符串类型错误代码。<i>例如ERROR 1142(42000)中的42000</i></td>
            </tr>
            <tr>
                <td>mysql_error_code</td>
                <td>为数值类型错误代码。<i>例如ERROR 1142(42000)中的1142</i></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- 定义处理程序-handler_type提示 -->
<div id="define_handler_handler_type_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">handler_type</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">sqlstate_value和mysql_error_code都可以表示MySQL的错误：</p>
        <table class="table table-hover">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>CONTINUE</td>
                <td>表示遇到错误不处理，继续执行</td>
            </tr>
            <tr>
                <td>EXIT</td>
                <td>表示遇到错误马上退出</td>
            </tr>
            <tr>
                <td>UNDO</td>
                <td>表示遇到错误后撤回之前的操作，<span class="note">MySQL中暂时不支持这样的操作</span></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- 定义处理程序-condition_value提示 -->
<div id="define_handler_condition_value_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">condition_value</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">sqlstate_value和mysql_error_code都可以表示MySQL的错误：</p>
        <table class="table table-hover">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>SQLSTATE [VALUE] sqlstate_value</td>
                <td>包含5个字符的字符串错误值</td>
            </tr>
            <tr>
                <td>condition_name</td>
                <td>表示DECLARE CONDITION定义的错误条件名称</td>
            </tr>
            <tr>
                <td>SQLWARNING</td>
                <td>匹配所有以01开头的SQLSTATE错误代码</td>
            </tr>
            <tr>
                <td>NOT FOUND</td>
                <td>匹配所有以02开头的SQLSTATE错误代码</td>
            </tr>
            <tr>
                <td>SQLEXCEPTION</td>
                <td>匹配所有没有被SQLWARNING或NOT FOUND捕获的SQLSTATE错误代码</td>
            </tr>
            <tr>
                <td>mysql_error_code</td>
                <td>匹配数值类型错误代码</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- 光标的使用提示 -->
<div id="use_of_the_cursor_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">光标的使用</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">查询语句可能返回多条记录，如果数据量非常大，需要在存储过程和存储函数中使用光标来逐条读取查询结果集中的记录。应用程序可以根据需要滚动或浏览其中的数据。</p>
        <p class="firstLineIndent"><span class="bold note">光标必须在声明处理程序之前被声明，并且变量和条件还必须在声明光标或处理程序之前被声明。</span></p>
    </div>
</div>

<!-- 流程控制的使用提示 -->
<div id="use_of_process_control_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">流程控制的使用</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">流程控制语句用来根据条件控制语句的执行。MySQL中用来构造控制流程的语句有IF语句、CASE语句、LOOP语句、LEAVE语句、ITERATE语句、REPEAT语句和WHILE语句。</p>
        <p class="firstLineIndent">每个流程可能包含一个单独语句，或者是使用BEGIN...END构造的复合语句，构造可以被嵌套。</p>
    </div>
</div>

<!-- 流程控制的使用-IF语句 -->
<div id="use_of_process_control_if" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">IF语句</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">IF语句包含多个条件判断，根据判断的结果为<b>TRUE</b>或<b>FALSE</b>执行相应的语句，语法格式如下：</p>
        <p class="firstLineIndent"><code>IF expr_condition THEN statement_list</code></p>
        <p class="tabIndentation"><code>[ELSEIF expr_condition THEN statement_list] ...</code></p>
        <p class="tabIndentation"><code>[ELSE statement_list]</code></p>
        <p class="firstLineIndent"><code>END IF</code></p>
        <p class="firstLineIndent">IF实现了一个基本的条件构造。如果expr_condition求值为真（TRUE），相应的SQL语句列表被执行；如果没有expr_condition匹配，则ELSE子句里的语句列表被执行。statement_list可以包括一个或多个语句。</p>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">IF语句的示例，代码如下：</p>
        <pre>
            <code class="sql">
    IF val IS null
        THEN SELECT 'val is NULL';
        ELSE SELECT 'val is not NULL';
    END IF;
            </code>
        </pre>
    </div>
</div>

<!-- 流程控制的使用-CASE语句 -->
<div id="use_of_process_control_case" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">CASE语句</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">CASE语句是另一个进行条件判断的语句，有两种格式。</p>
        <p class="firstLineIndent">第一种格式如下</p>
        <p class="firstLineIndent"><code>CASE case_expr</code></p>
        <p class="tabIndentation"><code>WHEN when_value THEN statement_list</code></p>
        <p class="tabIndentation"><code>[WHEN when_value THEN statement_list] ...</code></p>
        <p class="tabIndentation"><code>[ELSE statement_list]</code></p>
        <p class="firstLineIndent"><code>END CASE</code></p>
        <hr>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>case_expr</td>
                <td>表示条件判断的表达式，决定了哪一个<code>WHEN</code>子句会被执行</td>
            </tr>
            <tr>
                <td>when_value</td>
                <td>表示表达式可能的值，如果某个<code>when_value</code>表达式与<code>case_expr</code>表达式结果相同，则执行对应<code>THEN</code>关键字后的<code>statement_list</code>中的语句</td>
            </tr>
            <tr>
                <td>statement_list</td>
                <td>表示不同<code>when_value</code>值的执行语句</td>
            </tr>
            </tbody>
        </table>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">使用CASE流程控制语句的第一种形式，判断val值等于1、等于2，或者两者都不等，代码如下：</p>
        <pre>
            <code class="sql">
    CASE val
        WHEN 1 THEN SELECT 'val is 1';
        WHEN 2 THEN SELECT 'val is 2';
        ELSE SELECT 'val is not 1 or 2';
    END CASE;
            </code>
        </pre>
        <hr>
        <p class="firstLineIndent">第二种格式如下</p>
        <p class="firstLineIndent"><code>CASE</code></p>
        <p class="tabIndentation"><code>WHEN expr_condition THEN statement_list</code></p>
        <p class="tabIndentation"><code>[WHEN expr_condition THEN statement_list] ...</code></p>
        <p class="tabIndentation"><code>[ELSE statement_list]</code></p>
        <p class="firstLineIndent"><code>END CASE</code></p>
        <hr>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>expr_condition</td>
                <td>表示条件判断语句</td>
            </tr>
            <tr>
                <td>statement_list</td>
                <td>表示不同条件的执行语句。该语句中，<code>WHEN</code>语句将被逐个执行，直到某个<code>expr_condition</code>表达式为真，则执行对应的<code>THEN</code>关键字后面的<code>statement_list</code>语句。如果没有条件匹配，<code>ELSE</code>子句里的语句被执行。</td>
            </tr>
            </tbody>
        </table>
        <p class="firstLineIndent">这里介绍的用在存储程序里的CASE语句与“条件判断函数”里描述的<code>SQL CASE</code>表达式的<code>CASE</code>语句有轻微不同。<span class="bold note">这里的<code>CASE</code>语句不能有<code>ELSE NULL</code>子句，并且用<code>END CASE</code>替代<code>END</code>来终止</span>。</p>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">使用CASE流程控制语句的第二种形式，判断val是否为空、小于0、大于0或者等于0，代码如下：</p>
        <pre>
            <code class="sql">
    CASE
        WHEN val is NULL THEN SELECT 'val is NULL';
        WHEN val < 0 THEN SELECT 'val is less than 0';
        WHEN val > 0 THEN SELECT 'val is greater than 0';
        ELSE SELECT 'val is 0';
    END CASE;
            </code>
        </pre>
    </div>
</div>

<!-- 流程控制的使用-LOOP语句 -->
<div id="use_of_process_control_loop" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">LOOP语句</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">LOOP循环语句用来重复执行某些语句，与IF和CASE语句相比，LOOP只是创建一个循环操作的过程，并不进行条件判断。LOOP内的语句一直重复执行直到循环被退出（使用LEAVE子句），跳出循环过程。语法格式如下：</p>
        <p class="firstLineIndent"><code>[loop_label:] LOOP</code></p>
        <p class="tabIndentation"><code>statement_list</code></p>
        <p class="firstLineIndent"><code>END LOOP [loop_label]</code></p>
        <hr>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>loop_label</td>
                <td>表示LOOP语句的标注名称，该参数可以省略</td>
            </tr>
            <tr>
                <td>statement_list</td>
                <td>表示需要循环执行的语句</td>
            </tr>
            </tbody>
        </table>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">使用LOOP语句进行循环操作，id值小于10时将重复执行循环过程，代码如下：</p>
        <pre>
            <code class="sql">
    DECLARE id INT DEFAULT 0;
    add_loop: LOOP
    SET id = id + 1;
        IF id >= 10 THEN LEAVE add_loop;
        END IF;
    END LOOP add_loop;
            </code>
        </pre>
    </div>
</div>

<!-- 流程控制的使用-LEAVE语句 -->
<div id="use_of_process_control_leave" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">LEAVE语句</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">LEAVE语句用来退出任何被标注的流程控制构造。语法格式如下：</p>
        <p class="firstLineIndent"><code>LEAVE label</code></p>
        <hr>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>label</td>
                <td>表示循环的标志。LEAVE和BEGIN...END或循环一起被使用</td>
            </tr>
            </tbody>
        </table>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">使用LEAVE语句退出循环，代码如下：</p>
        <pre>
            <code class="sql">
    add_num: LOOP
    SET @count = @count + 1;
        IF @count = 50 THEN LEAVE add_num;
    END LOOP add_num;
            </code>
        </pre>
    </div>
</div>

<!-- 流程控制的使用-ITERATE语句 -->
<div id="use_of_process_control_iterate" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">ITERATE语句</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">ITERATE语句将执行顺序转到语句段开头处。语法格式如下：</p>
        <p class="firstLineIndent"><code>ITERATE label</code></p>
        <p class="firstLineIndent">ITERATE只可以出现在<code>LOOP</code>、<code>REPEAT</code>和<code>WHILE</code>语句内。ITERATE的意思为“再次循环”，label参数表示循环的标志。ITERATE语句必须跟在循环标志前面。</p>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">ITERATE语句示例，代码如下：</p>
        <pre>
            <code class="sql">
    CREATE PROCEDURE doIterate()
    BEGIN
    DECLARE p1 INT DEFAULT 0;
    my_loop: LOOP
        SET p1 = p1 + 1;
        IF p1 < 10 THEN ITERATE my_loop;
        ELSEIF p1 > 20 THEN LEAVE my_loop;
        END IF;
        SELECT 'p1 is between 10 and 20';
    END LOOP my_loop;
    END
            </code>
        </pre>
    </div>
</div>

<!-- 流程控制的使用-REPEAT语句 -->
<div id="use_of_process_control_repeat" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">REPEAT语句</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">REPEAT语句创建一个带条件判断的循环过程，每次语句执行完毕之后会对条件表达式进行判断，如果表达式为真，则循环结束；否则重复执行循环中的语句。语法格式如下：</p>
        <p class="firstLineIndent"><code>[repeat_label:] REPEAT</code></p>
        <p class="tabIndentation"><code>statement_list</code></p>
        <p class="firstLineIndent"><code>UNTIL expr_condition</code></p>
        <p class="firstLineIndent"><code>END REPEAT [repeat_label]</code></p>
        <hr>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>repeat_label</td>
                <td>为REPEAT语句的标注名称，该参数可以省略；REPEAT语句内的语句或语句群被重复，直至expr_condition为真</td>
            </tr>
            </tbody>
        </table>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">REPEAT语句示例,id值小于10时将重复执行循环过程，代码如下：</p>
        <pre>
            <code class="sql">
    DECLARE id INT DEFAULT 0;
    REPEAT
    SET id = id + 1;
    UNTIL id >= 10
    END REPEAT;
            </code>
        </pre>
    </div>
</div>

<!-- 流程控制的使用-WHILE语句 -->
<div id="use_of_process_control_while" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">WHILE语句</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">WHILE语句创建一个带条件判断的循环过程，与REPEAT不同，WHILE在执行语句执行时，先对指定的表达式进行判断，如果为真，就执行循环内的语句，否则退出循环。语法格式如下：</p>
        <p class="firstLineIndent"><code>[while_label:] WHILE expr_condition DO</code></p>
        <p class="tabIndentation"><code>statement_list</code></p>
        <p class="firstLineIndent"><code>END WHILE [while_label]</code></p>
        <hr>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>while_label</td>
                <td>为WHILE语句的标注名称</td>
            </tr>
            <tr>
                <td>expr_condition</td>
                <td>为进行判断的表达式，如果表达式结果为真，WHILE语句内的语句或语句群被执行，直至expr_condition为假，退出循环</td>
            </tr>
            </tbody>
        </table>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">WHILE语句示例，i值小于10时，将重复执行循环过程，代码如下：</p>
        <pre>
            <code class="sql">
    DECLARE i INT DEFAULT 0;
    WHILE i < 10 DO
    SET i = i + 1;
    END WHILE;
            </code>
        </pre>
    </div>
</div>

<!-- 调用存储过程和函数提示 -->
<div id="call_stored_procedures_and_functions_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">调用存储过程和函数</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">存储过程已经定义好了，接下来需要知道如何调用这些过程和函数。</p>
        <p class="firstLineIndent">存储过程和函数有多种调用方法：</p>
        <ul>
            <li>存储过程（<b>Stored Procedure</b>）必须使用<code>CALL</code>语句调用，并且存储过程和数据库有关，如果要执行其他数据库中的存储过程，需要制定数据库名称，例如CALL dbname.procname</li>
            <li>存储函数（<b>Stored Function</b>）的调用与MySQL中预定义的函数的调用方式相同</li>
        </ul>
    </div>
</div>

<!-- 查看存储过程和函数-SHOW STATUS -->
<div id="view_stored_procedures_and_functions_show_status" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">SHOW STATUS</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">SHOW STATUS语句可以查看<b>存储过程</b>和<b>存储函数</b>的状态，其基本语法结构如下：</p>
        <p class="firstLineIndent"><code>SHOW {PROCEDURE | FUNCTION} STATUS [LIKE 'pattern']</code></p>
        <p class="firstLineIndent">这个语句是一个MySQL的扩展，返回子程序的特征，如数据库、名字、类型、创建者及创建和修改日期。如果没有指定样式，那么根据使用的语句，所有存储程序或存储函数的信息都会被列出。</p>
        <hr>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>{PROCEDURE | FUNCTION}</td>
                <td>分别表示查看存储过程和存储函数</td>
            </tr>
            <tr>
                <td>[LIKE 'pattern']</td>
                <td>表示匹配存储过程或存储函数的名称</td>
            </tr>
            </tbody>
        </table>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">SHOW STATUS语句示例，代码如下：</p>
        <pre>
            <code class="sql">
    mysql> SHOW PROCEDURE STATUS LIKE 'C%' \G
    *** 1.row ***
                          Db: test_db
                        Name: CountProc
                        Type: PROCEDURE
                     Definer: root@localhost
                    Modified: 2020-11-26 13:52:28
                     Created: 2020-11-26 13:52:28
               Security_type: DEFINER
                     Comment:
        character_set_client: gbk
        collation_connection: gbk_chinese_ci
          Database Collation: utf8mb4_0900_ai_ci
            </code>
        </pre>
    </div>
</div>

<!-- 查看存储过程和函数-SHOW CREATE -->
<div id="view_stored_procedures_and_functions_show_create" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">SHOW CREATE</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">SHOW CREATE语句可以查看<b>存储过程</b>和<b>存储函数</b>的状态，其基本语法结构如下：</p>
        <p class="firstLineIndent"><code>SHOW CREATE {PROCEDURE | FUNCTION} sp_name</code></p>
        <p class="firstLineIndent">这个语句是一个MySQL的扩展。类似于<code>SHOW CREATE TABLE</code>，它返回一个可用来重新创建已命名子程序的确切字符串。</p>
        <hr>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>{PROCEDURE | FUNCTION}</td>
                <td>分别表示查看存储过程和存储函数</td>
            </tr>
            <tr>
                <td>sp_name</td>
                <td>表示匹配存储过程或存储函数的名称</td>
            </tr>
            </tbody>
        </table>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">SHOW CREATE语句示例，代码如下：</p>
        <pre>
            <code class="sql">
    mysql> SHOW CREATE FUNCTION test_db.CountProc2 \G
    **************** 1.row ***************************
                Function: CountProc2
                sql_mode: STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION
    Create Function:
    CREATE DEFINER=`root`@`localhost` FUNCTION `CountProc2`(sid INT) RETURNS int(11)
    BEGIN
    RETURN (SELECT COUNT(*) FROM fruits WHERE s_id = sid);
    END
    character_set_client: gbk
    collation_connection: gbk_chinese_ci
      Database Collation: utf8mb4_0900_ai_ci
            </code>
        </pre>
    </div>
</div>

<!-- 查看存储过程和函数-information_schema -->
<div id="view_stored_procedures_and_functions_information_schema" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">information_schema</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">MySQL中存储过程和存储函数的信息存储在information_schema数据库下的<code>Routines</code>表中。可以通过查询该表的记录来查询存储过程和函数的信息。其基本语法形式如下：</p>
        <p class="firstLineIndent"><code>SELECT * FROM information_schema.Routines WHERE ROUTINE_NAME = 'sp_name';</code></p>
        <hr>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>ROUTINE_NAME</td>
                <td>这个字段中存储的是存储过程和存储函数的名称</td>
            </tr>
            <tr>
                <td>sp_name</td>
                <td>表示存储过程或存储函数的名称</td>
            </tr>
            </tbody>
        </table>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">从Routines表中查询名称为CountProc2的存储函数的信息，代码如下：</p>
        <pre>
            <code class="sql">
    mysql> SELECT * FROM information_schema.Routines
        -> WHERE ROUTINE_NAME = 'CountProc2' AND ROUTINE_TYPE = 'FUNCTION' \G
    ***************************** 1.row ***************************
               SPECIFIC_NAME: CountProc2
             ROUTINE_CATALOG: def
              ROUTINE_SCHEMA: test_db
                ROUTINE_NAME: CountProc2
                ROUTINE_TYPE: FUNCTION
                   DATA_TYPE: int
    CHARACTER_MAXIMUM_LENGTH: NULL
      CHARACTER_OCTET_LENGTH: NULL
           NUMERIC_PRECISION: 10
               NUMERIC_SCALE: 0
          DATETIME_PRECISION: NULL
          CHARACTER_SET_NAME: NULL
              COLLATION_NAME: NULL
              DTD_IDENTIFIER: int(11)
                ROUTINE_BODY: SQL
          ROUTINE_DEFINITION: BEGIN
    RETURN (SELECT COUNT(*) FROM fruits WHERE s_id = sid);
    END
               EXTERNAL_NAME: NULL
           EXTERNAL_LANGUAGE: SQL
             PARAMETER_STYLE: SQL
            IS_DETERMINISTIC: NO
             SQL_DATA_ACCESS: CONTAINS SQL
                    SQL_PATH: NULL
               SECURITY_TYPE: DEFINER
                     CREATED: 2020-11-26 13:44:36
                LAST_ALTERED: 2020-11-26 13:44:36
                    SQL_MODE: STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION
             ROUTINE_COMMENT:
                     DEFINER: root@localhost
        CHARACTER_SET_CLIENT: gbk
        COLLATION_CONNECTION: gbk_chinese_ci
          DATABASE_COLLATION: utf8mb4_0900_ai_ci
            </code>
        </pre>
        <p class="firstLineIndent">在<code>information_schema</code>数据库下的<code>Routines</code>表中，存储所有存储过程和存储函数的定义。</p>
        <p class="firstLineIndent">使用SELECT语句查询Routines表中的存储过程和存储函数的定义时，一定要使用<code>ROUTINE_NAME</code>字段指定存储过程或存储函数的名称。否则，将查询出所有的存储过程或存储函数的定义。</p>
        <p class="firstLineIndent">如果有存储过程和存储函数名称相同，就需要同时指定<code>ROUTINE_TYPE</code>字段表明查询的是哪种类型的存储程序。</p>
    </div>
</div>

<!-- 修改存储过程或函数-characteristics提示 -->
<div id="modify_a_stored_procedure_or_function_characteristics_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">characteristics形式</h3>
    </div>
    <div class="panel-body">
        <table class="table table-hover">
            <thead>
            <tr>
                <th>特性</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>CONTAINS SQL</td>
                <td>表示子程序包含SQL语句，但不包含读或写数据的语句</td>
            </tr>
            <tr>
                <td>NO SQL</td>
                <td>表示子程序中不包含SQL语句</td>
            </tr>
            <tr>
                <td>READS SQL DATA</td>
                <td>表示子程序中包含读数据的语句</td>
            </tr>
            <tr>
                <td>MODIFIES SQL DATA</td>
                <td>表示子程序中包含写数据的语句</td>
            </tr>
            <tr>
                <td>SQL SECURITY {DEFINER | INVOKER}</td>
                <td>指明谁有权限来执行</td>
            </tr>
            <tr>
                <td>DEFINER</td>
                <td>表示只有定义者自己才能够执行</td>
            </tr>
            <tr>
                <td>INVOKER</td>
                <td>表示调用者可以执行</td>
            </tr>
            <tr>
                <td>COMMENT 'string'</td>
                <td>表示注释信息</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- CUSTOM JAVASCRIPT -->
<script type="text/javascript" src="../../../assets/scripts/common-method.js"></script>
<script type="text/javascript" src="../../../assets/scripts/base.js"></script>
<script type="text/javascript" src="../../../assets/scripts/responseStatusCode.js"></script>
<script type="text/javascript" src="../../../assets/scripts/mysql/mysql-advanced-knowledge/mysql-advanced-knowledge-stored-procedure.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>

</html>
