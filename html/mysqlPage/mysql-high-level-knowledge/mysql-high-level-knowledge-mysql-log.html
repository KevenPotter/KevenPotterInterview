<!doctype html>
<html lang="en">

<head>
    <title>高阶知识-MySQL日志</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <!-- Javascript -->
    <script type="text/javascript" src="../../../assets/vendor/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/bootstrap/js/bootstrap-paginator.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/bootstrap-select/js/bootstrap-select.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/jquery-slimscroll/jquery.slimscroll.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/echarts/echarts.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/echarts/theme/macarons.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/layer/layer.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/laydate/laydate.js"></script>
    <script type="text/javascript" src="../../../assets/scripts/klorofil-common.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/ui-choose/js/ui-choose.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/highlight/highlight.pack.js"></script>
    <!-- VENDOR CSS -->
    <link rel="stylesheet" href="../../../assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../assets/vendor/bootstrap-select/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="../../../assets/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../assets/vendor/linearicons/style.css">
    <link rel="stylesheet" href="../../../assets/vendor/ui-choose/css/ui-choose.css">
    <link rel="stylesheet" href="../../../assets/vendor/highlight/styles/rainbow.css">
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="../../../assets/css/main.css">
    <!-- CUSTOMIZE CSS -->
    <link rel="stylesheet" href="../../../assets/css/roundButton.css">
    <!-- FOR DEMO PURPOSES ONLY. You should remove this in your project -->
    <link rel="stylesheet" href="../../../assets/css/demo.css">
    <!-- GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet">
    <!-- ICONS -->
    <link rel="apple-touch-icon" sizes="76x76" href="../../../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../../../assets/img/favicon.png">
</head>

<body>
<!-- WRAPPER -->
<div id="wrapper">
    <!-- NAVBAR -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="brand">
            <a href="../../../index.html"><img src="../../../assets/img/logo-KevenPotter.png" alt="KevenPotter Logo" class="img-responsive logo"></a>
        </div>
        <div class="container-fluid">
            <div class="navbar-btn">
                <button type="button" class="btn-toggle-fullwidth"><i class="lnr lnr-arrow-left-circle"></i></button>
            </div>
            <form class="navbar-form navbar-left">
                <div class="input-group">
                    <input type="text" value="" class="form-control" placeholder="搜索内容...">
                    <span class="input-group-btn"><button type="button" class="btn btn-primary">Go</button></span>
                </div>
            </form>
        </div>
    </nav>
    <!-- END NAVBAR -->
    <!-- LEFT SIDEBAR -->
    <div id="sidebar-nav" class="sidebar">
        <div class="sidebar-scroll">
            <nav>
                <ul class="nav">
                    <li><a href="../../../index.html" class=""><i class="lnr lnr-home"></i> <span>首页</span></a></li>
                    <li>
                        <a href="#distributedPage" data-toggle="collapse" class="collapsed"><i class="lnr lnr-cloud"></i> <span>分布式</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                        <div id="distributedPage" class="collapse ">
                            <ul class="nav">
                                <li><a href="../../distributedPage/distributed_overview.html" class="">分布式概述</a></li>
                                <li><a href="../../distributedPage/zookeeper_overview.html" class="">ZooKeeper概述</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="#designPatternsPage" data-toggle="collapse" class="collapsed"><i class="lnr lnr-laptop"></i> <span>设计模式</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                        <div id="designPatternsPage" class="collapse ">
                            <ul class="nav">
                                <li><a href="../../designPatternsPage/six_principles.html" class="">六大原则</a></li>
                                <li><a href="../../designPatternsPage/singleton_pattern.html" class="">单例模式</a></li>
                                <li><a href="../../designPatternsPage/factory_method_pattern.html" class="">工厂方法模式</a></li>
                                <li><a href="../../designPatternsPage/abstract_factory_pattern.html" class="">抽象工厂模式</a></li>
                                <li><a href="../../designPatternsPage/template_method_pattern.html" class="">模板方法模式</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a id="database_page_button" href="#databasePage" data-toggle="collapse" class="collapsed"><i class="lnr lnr-database"></i> <span>数据库</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                        <div id="databasePage" class="collapse ">
                            <ul class="nav">
                                <li><a href="../mysql-basic-knowledge.html" class="">基础知识</a></li>
                                <li>
                                    <a href="#advanced_knowledge" data-toggle="collapse" class="collapsed"><span>进阶知识</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                                    <div id="advanced_knowledge" class="collapse ">
                                        <ul class="nav">
                                            <li><a href="../mysql-advanced-knowledge/mysql-advanced-knowledge-index.html" class=""><i class="lnr"></i>索引</a></li>
                                            <li><a href="../mysql-advanced-knowledge/mysql-advanced-knowledge-view.html" class=""><i class="lnr"></i>视图</a></li>
                                            <li><a href="../mysql-advanced-knowledge/mysql-advanced-knowledge-stored-procedure.html" class=""><i class="lnr"></i>存储过程</a></li>
                                            <li><a href="../mysql-advanced-knowledge/mysql-advanced-knowledge-trigger.html" class=""><i class="lnr"></i>触发器</a></li>
                                        </ul>
                                    </div>
                                </li>
                                <li>
                                    <a id="database_page_high_level_button" href="#high_level_knowledge" data-toggle="collapse" class="collapsed"><span>高阶知识</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                                    <div id="high_level_knowledge" class="collapse ">
                                        <ul class="nav">
                                            <li><a href="mysql-high-level-knowledge-authority-and-security-management.html" class=""><i class="lnr"></i>权限与安全管理</a></li>
                                            <li><a href="mysql-high-level-knowledge-database-backup-and-recovery.html" class=""><i class="lnr"></i>数据库备份与恢复</a></li>
                                            <li><a href="mysql-high-level-knowledge-mysql-log.html" class="active"><i class="lnr"></i>MySQL 日志</a></li>
                                        </ul>
                                    </div>
                                </li>
                                <li><a href="../mysql-sub-database_sub-table.html" class="">分库分表</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <!-- END LEFT SIDEBAR -->
    <!-- MAIN -->
    <div class="main">
        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="container-fluid">
                <h3 class="page-title tinyHand" onclick="mysqlLogTips()">MySQL日志 <i class="fa fa-hand-pointer-o"></i></h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="logClassificationTips()">日志分类 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div id="log_classification" style="height:500%;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="dataRecoveryTips()">数据恢复 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div id="data_recovery" style="height:500%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="databaseMigrationTips()">数据库迁移 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div id="database_migration" style="height:500%;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="tableExportAndImportTips()">表的导出和导入 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div id="table_export_and_import" style="height:500%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END MAIN CONTENT -->
    </div>
    <!-- END MAIN -->
    <div class="clearfix"></div>
    <footer>
        <div class="container-fluid">
            <p class="copyright">Copyright &copy; https://github.com/KevenPotter/KevenPotterInterview <a href="https://github.com/KevenPotter/KevenPotterInterview" target="_blank" title="KevenPotter">KevenPotter</a> - Collect from <a href="https://github.com/KevenPotter" title="Github"
                                                                                                                                                                                                                                          target="_blank">KevenPotter主页</a></p>
        </div>
    </footer>
</div>
<!-- END WRAPPER -->

<!-- mysql日志提示 -->
<div id="mysql_log_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">mysql日志</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">MySQL日志记录了MySQL数据库日常操作和错误信息。MySQL有不同类型的日志文件（各自存储了不同类型的日志），从日志当中可以查询到MySQL数据库的运行情况、用户操作、错误信息等，可以为MySQL管理和优化提供必要的信息。对于MySQL的管理工作而言，这些日志文件是不可缺少的。</p>
    </div>
</div>

<!-- 日志分类提示 -->
<div id="log_classification_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">日志分类</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">MySQL日志主要分为4类，使用这些日志文件，可以查看MySQL内部发生的事情。这4类日志分别是：</p>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>日志</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>错误日志</td>
                <td>记录MySQL服务的启动、运行或停止MySQL服务时出现的问题</td>
            </tr>
            <tr>
                <td>查询日志</td>
                <td>记录建立的客户端连接和执行的语句</td>
            </tr>
            <tr>
                <td>二进制日志</td>
                <td>记录所有更改数据的语句，可以用于数据复制</td>
            </tr>
            <tr>
                <td>慢查询日志</td>
                <td>记录所有执行时间超过<b>long_query_time</b>的所有查询或不使用索引的查询</td>
            </tr>
            </tbody>
        </table>
        <p class="firstLineIndent">
            默认情况下，所有日志创建于MySQL数据目录中。通过刷新日志，可以强制MySQL关闭和重新打开日志文件（或者在某些情况下切换到一个新的日志）。当执行一个<code>FLUSH LOGS</code>语句或执行
            <code>mysqladmin flush-logs</code>或<code>mysqladmin refresh</code>时，将刷新日志。
        </p>
        <p class="firstLineIndent">如果正使用MySQL复制功能，在复制服务器上可以维护更多日志文件，这种日志称为<b>接替日志</b>。</p>
        <p class="firstLineIndent"><b>启动日志功能会降低MySQL数据库的性能。</b>例如，在查询非常频繁的MySQL数据库系统中，如果开启了通用查询日志和慢查询日志，MySQL数据库会花费很多时间记录日志。同时，日志会占用大量的磁盘空间。</p>
    </div>
</div>

<!-- 日志分类-二进制日志 -->
<div id="log_classification_binary_log" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title tinyHand" onclick="logClassificationBinaryLogTips()">二进制日志 <i class="fa fa-hand-pointer-o"></i></h3>
    </div>
    <div class="panel-body">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#log_classification_binary_log_1" data-toggle="tab">启动和设置二进制日志</a></li>
            <li><a href="#log_classification_binary_log_2" data-toggle="tab">查看二进制日志</a></li>
            <li class="dropdown">
                <a href="#" id="log_classification_binary_log_3" class="dropdown-toggle" data-toggle="dropdown">删除二进制日志<b class="caret"></b></a>
                <ul class="dropdown-menu" role="menu" aria-labelledby="log_classification_binary_log_3">
                    <li><a href="#log_classification_binary_log_3_1" tabindex="-1" data-toggle="tab">使用RESET MASTER语句删除所有二进制日志文件</a></li>
                    <li><a href="#log_classification_binary_log_3_2" tabindex="-1" data-toggle="tab">使用PURGE MASTER LOGS语句删除指定日志文件</a></li>
                </ul>
            </li>
            <li><a href="#log_classification_binary_log_4" data-toggle="tab">使用二进制日志恢复数据库</a></li>
            <li><a href="#log_classification_binary_log_5" data-toggle="tab">暂时停止二进制日志功能</a></li>
        </ul>
        <div class="tab-content">
            <div id="log_classification_binary_log_1" class="tab-pane fade in active">
                <p class="firstLineIndent">默认情况下，二进制日志是开启的，可以通过修改MySQL的配置文件来启动和设置二进制日志。</p>
                <p class="firstLineIndent">my.ini中[mysqld]组下面有关于二进制日志的设置：</p>
                <p class="firstLineIndent"><b>log-bin [=path/ [filename]]</b></p>
                <hr>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>参数</th>
                        <th>作用</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>log-bin [=path/ [filename]]</td>
                        <td class="tinyHand" onclick="logClassificationBinaryLog1LogBinTips()">定义开启二进制日志 <i class="fa fa-hand-pointer-o"></i></td>
                    </tr>
                    <tr>
                        <td>expire_logs_days</td>
                        <td>定义了MySQL清除过期日志的时间，即二进制日志自动删除的天数。默认值为0，表示“没有自动删除”。当MySQL启动或刷新二进制日志时可能删除该文件</td>
                    </tr>
                    <tr>
                        <td>max_binlog_size</td>
                        <td>
                            定义了单个文件的大小限制，如果二进制日志写入的内容大小超出给定值，日志就会发生滚动（关闭当前文件，重新打开一个新的日志文件）。<b>不能将该变量设置为大于1GB或小于4096B，默认值是1GB</b>。
                            如果正在使用大的事务，二进制日志文件大小还可能会超过max_binlog_size定义的大小
                        </td>
                    </tr>
                    </tbody>
                </table>
                <p class="firstLineIndent">在my.ini配置文件中的[mysqld]组下，添加以下几个参数与参数值</p>
                <pre>
                    <code class="sql">
    [mysqld]
    log-bin
    expire_logs_days = 10
    max_binlog_size = 100M
                    </code>
                </pre>
                <p class="firstLineIndent">添加完毕后，关闭并重新启动MySQL服务进程，即可打开二进制日志，然后可以通过<code>SHOW VARIABLES</code>语句来查询日志设置。</p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用SHOW VARIABLES语句查询日志设置，执行的语句及结果如下：</p>
                <pre>
                    <code class="sql">
    mysql> SHOW VARIABLES LIKE 'log_%';
    +------------------------------------------+-------------------------------------------------------------------------+
    | Variable_name                            |  Value                                                                  |
    +------------------------------------------+-------------------------------------------------------------------------+
    | log_bin                                  | ON                                                                      |
    | log_bin_basename                         | C:\ProgramData\MySQL\MySQL Server 8.0\Data\X0NHUMO7YDZVSST-bin          |
    | log_bin_index                            | C:\ProgramData\MySQL\MySQL Server 8.0\Data\X0NHUMO7YDZVSST-bin.index    |
    | log_bin_trust_function_creators          | OFF                                                                     |
    | log_bin_use_v1_row_events                | OFF                                                                     |
    | log_error                                | .\X0NHUMO7YDZVSSI.err                                                   |
    | log_error_services                       | log_filter_internal;log_sink_internal                                   |
    | log_error_suppression_list               |                                                                         |
    | log_error_verbosity                      | 2                                                                       |
    | log_output                               | FILE                                                                    |
    | log_queries_not_using_indexed            | OFF                                                                     |
    | log_slave_updates                        | ON                                                                      |
    | log_slow_admin_statements                | OFF                                                                     |
    | log_slow_slave_statements                | OFF                                                                     |
    | log_statements_unsafe_for_binlog_indexes | ON                                                                      |
    | log_throttle_queries_not_using_indexes   | 0                                                                       |
    | log_timestamps                           | UTC                                                                     |
    +------------------------------------------+-------------------------------------------------------------------------+
                    </code>
                </pre>
                <p class="firstLineIndent">通过上面的查询结果可以看出，log_bin变量的值为ON，表明二进制日志已经打开。MySQL重新启动之后，可以在自己的机器上的MySQL数据文件夹下面看到新生成的文件后缀为.000001和.index的两个文件，文件名称为默认主机名称。</p>
                <p class="firstLineIndent"><span class="note">注意</span>：数据库文件最好不要与日志文件放在同一个磁盘上，这样当数据库文件所在的磁盘发生故障时，可以使用日志文件恢复数据。</p>
            </div>
            <div id="log_classification_binary_log_2" class="tab-pane fade">
                <p class="firstLineIndent">
                    MySQL二进制日志存储了所有的变更信息，MySQL二进制日志是经常用到的。当MySQL创建二进制日志文件时，先创建一个以“filename”为名称、以“.index”为后缀的文件，再创建一个以“filename”为名称、
                    以“.000001”为后缀的文件。MySQL服务重新启动一次，以“.000001”为后缀的文件会增加一个，并且后缀名加1递增；如果日志长度超过了max_binlog_size的上限（默认是1GB），就会创建一个新的日志文件。
                </p>
                <p class="firstLineIndent"><code>SHOW BINARY LOGS</code>语句可以查看当前的二进制日志文件个数及其文件名。MySQL二进制日志并不能直接查看，如果要查看日志内容，可以通过<code>mysqlbinlog</code>命令查看。</p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用SHOW BINARY LOGS查看二进制日志文件个数及文件名，执行命令及结果如下：</p>
                <pre>
                    <code class="sql">
    mysql> SHOW BINARY LOGS;
    +------------------------------+-----------+
    |             Log_name         | File_size |
    +------------------------------+-----------+
    |  X0NHUNO7YDZVSSI-bin.000001  |    178    |
    +------------------------------+-----------+
    1 row in set (0.00 sec)
                    </code>
                </pre>
                <p class="firstLineIndent">可以看到，当前只有一个二进制日志文件。日志文件的个数与MySQL服务启动的次数相同。每启动一次MySQL服务，将会产生一个新的日志文件。</p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用mysqlbinlog查看二进制日志，执行命令及结果如下：</p>
                <pre>
                    <code class="sql">
    C:\ >mysqlbinlog D:/mysql/log/binlog.000001
    /*!40019 SET @@session.max_insert_delayed_threads=0*/;
    /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;
    DELIMITER /*!*/;
    # at 4
    #190130 15:27:48 server id 1 end_log_pos 107 Start: binlog v 4, server v 8.0.13-log created 160330
    # Warning: this binlog is either in use or was not closed properly.
    ROLLBACK/*!*/;
    BINLOG '
    9JBcTg8BAAAAZwAAAGsAAAABAAQANS41LjEzLWXxvZwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
    AAAAAAAAAAAAAAAAAAD0kFxOEzgNAAgAEgAEBAQEEgAAVAAEggAAAAICAgCAA==
    '/*!*/;
    # at 107
    #190330 15:34:17 server id 1 end_log_pos 175 thread_id=2 exec_time=0
    error_code=0
    SET TIMESTAMP=1314689657/*!*/;
    SET @@session.pseudo_thread_id=2/*!*/;
    SET @@session.foreign_key_checks=1,@@session.sql_auto_is_null=0,@@session.unique_checks=1,
    @@session
    SET @@session.sql_mode=0/*!*/;
    SET @@session.auto_increment_increment=1,@@session.auto_increment_offset=1/*!*/;
    /*!\C gb2312 *//*!*/;
    SET @@session.character_set_client=24,@@session.collation_connection=24,@@session.collation_server=24/
    SET @@session.lc_time_names=0/*!*/;
    SET @@session.collation_database=DEFAULT/*!*/;
    BEGIN
    /*!*/;
    # at 175
    #190130 15:34:17 server id 1 end_log_pos 289 Query thread_id=2 exec_time=0
    use test/*!*/;
    SET TIMESTAMP=1314689657/*!*/;
    UPDATE fruits set f_price = 5.00 WHERE f_id = 'a1'
    /*!*/;
    # at 289
    #190330 15:34:17 server id 1 end_log_pos 316 Xid = 14
    COMMIT/*!*/;
    DELIMITER ;
    # End of log file
    ROLLBACK /* added by mysqlbinlog */
    /*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;
                    </code>
                </pre>
                <p class="firstLineIndent">这是一个简单的日志文件，日志中记录了一些用户的操作。从文件内容中可以看到，用户对fruits表进行了更新操作，语句为“UPDATE fruits SET f_price = 5.00 WHERE f_id = 'a1';”。</p>
            </div>
            <div id="log_classification_binary_log_3_1" class="tab-pane fade">
                <p class="firstLineIndent">MySQL的二进制文件可以配置自动删除，同时MySQL也提供了安全的手动删除二进制文件的方法：<code>RESET MASTER</code>删除所有的二进制日志文件；<code>PURGE MASTER LOGS</code>只删除部分二进制日志文件。</p>
                <p class="firstLineIndent">RESET MASTER语法如下：</p>
                <p class="firstLineIndent"><code>RESET MASTER;</code></p>
                <p class="firstLineIndent">执行完该语句后，所有二进制日志将被删除，MySQL会重新创建二进制日志，新的日志文件扩展名将重新从000001开始编号。</p>
            </div>
            <div id="log_classification_binary_log_3_2" class="tab-pane fade">
                <p class="firstLineIndent">MySQL的二进制文件可以配置自动删除，同时MySQL也提供了安全的手动删除二进制文件的方法：<code>RESET MASTER</code>删除所有的二进制日志文件；<code>PURGE MASTER LOGS</code>只删除部分二进制日志文件。</p>
                <p class="firstLineIndent">PURGE MASTER LOGS语法如下：</p>
                <p class="firstLineIndent"><code>PURGE {MASTER | BINARY} LOGS TO 'log_name';</code></p>
                <p class="firstLineIndent"><code>PURGE {MASTER | BINARY} LOGS BEFORE 'date';</code></p>
                <p class="firstLineIndent">第1种方法指定文件名，执行该命令将删除文件名编号比指定文件名编号小的所有日志文件。第2种方法指定日期，执行该命令将删除指定日期以前的所有日志文件。</p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用PURGE MASTER LOGS删除创建时间比X0NHUNO7YDZVSSI-bin.000003早的所有日志文件：</p>
                <pre>
                    <code class="sql">
    mysql> SHOW BINARY LOGS;
    +------------------------------+-----------+
    |             Log_name         | File_size |
    +------------------------------+-----------+
    |  X0NHUNO7YDZVSSI-bin.000001  |    178    |
    |  X0NHUNO7YDZVSSI-bin.000002  |    641    |
    |  X0NHUNO7YDZVSSI-bin.000003  |    345    |
    +------------------------------+-----------+
    3 rows in set (0.01 sec)
    mysql>
    mysql>
    mysql> PURGE MASTER LOGS TO "X0NHUNO7YDZVSSI-bin.000003";
    Query OK, 0 rows affected (0.07 sec)
    mysql>
    mysql>
    mysql> SHOW BINARY LOGS;
    +------------------------------+-----------+
    |             Log_name         | File_size |
    +------------------------------+-----------+
    |  X0NHUNO7YDZVSSI-bin.000003  |    345    |
    +------------------------------+-----------+
                    </code>
                </pre>
                <p class="firstLineIndent">可以看到，X0NHUNO7YDZVSSI-bin.000001、X0NHUNO7YDZVSSI-bin.000002两个日志文件被删除了。</p>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用PURGE MASTER LOGS删除2019年1月30日前创建的所有日志文件，执行命令及结果如下：</p>
                <pre>
                    <code class="sql">
    mysql> PURGE MASTER LOGS BEFORE "20190130";
    Query OK, 0 rows affected (0.07 sec)
                    </code>
                </pre>
                <p class="firstLineIndent">语句执行之后，2019年1月30日之前创建的日志文件都将被删除，但2019年1月30日的日志会被保留。使用mysqlbinlog可以查看指定日志的创建时间，部分日志内容如下：</p>
                <pre>
                    <code class="sql">
    /*!40019 SET @@session.max_insert_delayed_threads=0*/;
    /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;
    DELIMITER /*!*/;
    # at 4
    #190130 15:27:48 server id 1 end_log_pos 107 Start: binlog v 4, server v 8.0.13-log created 160330
    # Warning: this binlog is either in use or was not closed properly.
    ROLLBACK/*!*/;
    BINLOG '
                    </code>
                </pre>
                <p class="firstLineIndent">其中，190130为日志创建的时间，即2019年1月30日。</p>
            </div>
            <div id="log_classification_binary_log_4" class="tab-pane fade">
            </div>
            <div id="log_classification_binary_log_5" class="tab-pane fade">
            </div>
        </div>
    </div>
</div>

<!-- 日志分类-二进制日志提示 -->
<div id="log_classification_binary_log_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">二进制日志</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            二进制日志主要记录MySQL数据库的变化。二进制日志以一种有效的格式并且是事务安全的方式包含更新日志中可用的所有信息。二进制日志包含了所有更新了数据或者已经
            潜在更新了数据（例如，没有匹配任何行的一个DELETE）的语句。语句以“事件”的形式保存，描述数据更改。
        </p>
        <p class="firstLineIndent">
            二进制日志还包含关于每个更新数据库的语句的执行时间信息。它不包含没有修改任何数据的语句。如果想要记录所有语句（例如，为了识别有问题的查询），需要使用一般
            查询日志。<b>使用二进制日志的主要目的是最大可能地<span class="note">恢复数据库</span>，因为二进制日志包含备份后进行的所有更新。</b>
        </p>
    </div>
</div>

<!-- 日志分类-二进制日志-启动和设置二进制日志-log-bin提示 -->
<div id="log_classification_binary_log_1_log_bin_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">log-bin [=path/ [filename]]</h3>
    </div>
    <div class="panel-body">
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>log-bin</td>
                <td>定义开启二进制日志</td>
            </tr>
            <tr>
                <td>path</td>
                <td>表明日志文件所在的目录路径</td>
            </tr>
            <tr>
                <td>filename</td>
                <td>指定了日志文件的名称，如文件的全名为filename.000001、filename.000002等。除了上述文件之外，还有一个名称为filename.index的文件，文件内容为所有日志的清单，可以使用记事本打开该文件</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- CUSTOM JAVASCRIPT -->
<script type="text/javascript" src="../../../assets/scripts/common-method.js"></script>
<script type="text/javascript" src="../../../assets/scripts/base.js"></script>
<script type="text/javascript" src="../../../assets/scripts/responseStatusCode.js"></script>
<script type="text/javascript" src="../../../assets/scripts/mysql/mysql-high-level-knowledge/mysql-high-level-knowledge-mysql-log.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>

</html>
