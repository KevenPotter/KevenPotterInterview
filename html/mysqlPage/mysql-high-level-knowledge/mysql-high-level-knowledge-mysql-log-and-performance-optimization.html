<!doctype html>
<html lang="en">

<head>
    <title>高阶知识-MySQL日志与性能优化</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <!-- Javascript -->
    <script type="text/javascript" src="../../../assets/vendor/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/bootstrap/js/bootstrap-paginator.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/bootstrap-select/js/bootstrap-select.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/jquery-slimscroll/jquery.slimscroll.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/echarts/echarts.min.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/echarts/theme/macarons.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/layer/layer.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/laydate/laydate.js"></script>
    <script type="text/javascript" src="../../../assets/scripts/klorofil-common.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/ui-choose/js/ui-choose.js"></script>
    <script type="text/javascript" src="../../../assets/vendor/highlight/highlight.pack.js"></script>
    <!-- VENDOR CSS -->
    <link rel="stylesheet" href="../../../assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../assets/vendor/bootstrap-select/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="../../../assets/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../assets/vendor/linearicons/style.css">
    <link rel="stylesheet" href="../../../assets/vendor/ui-choose/css/ui-choose.css">
    <link rel="stylesheet" href="../../../assets/vendor/highlight/styles/rainbow.css">
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="../../../assets/css/main.css">
    <!-- CUSTOMIZE CSS -->
    <link rel="stylesheet" href="../../../assets/css/roundButton.css">
    <!-- FOR DEMO PURPOSES ONLY. You should remove this in your project -->
    <link rel="stylesheet" href="../../../assets/css/demo.css">
    <!-- GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet">
    <!-- ICONS -->
    <link rel="apple-touch-icon" sizes="76x76" href="../../../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../../../assets/img/favicon.png">
</head>

<body>
<!-- WRAPPER -->
<div id="wrapper">
    <!-- NAVBAR -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="brand">
            <a href="../../../index.html"><img src="../../../assets/img/logo-KevenPotter.png" alt="KevenPotter Logo" class="img-responsive logo"></a>
        </div>
        <div class="container-fluid">
            <div class="navbar-btn">
                <button type="button" class="btn-toggle-fullwidth"><i class="lnr lnr-arrow-left-circle"></i></button>
            </div>
            <form class="navbar-form navbar-left">
                <div class="input-group">
                    <input type="text" value="" class="form-control" placeholder="搜索内容...">
                    <span class="input-group-btn"><button type="button" class="btn btn-primary">Go</button></span>
                </div>
            </form>
        </div>
    </nav>
    <!-- END NAVBAR -->
    <!-- LEFT SIDEBAR -->
    <div id="sidebar-nav" class="sidebar">
        <div class="sidebar-scroll">
            <nav>
                <ul class="nav">
                    <li><a href="../../../index.html" class=""><i class="lnr lnr-home"></i> <span>首页</span></a></li>
                    <li>
                        <a href="#distributedPage" data-toggle="collapse" class="collapsed"><i class="lnr lnr-cloud"></i> <span>分布式</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                        <div id="distributedPage" class="collapse ">
                            <ul class="nav">
                                <li><a href="../../distributedPage/distributed_overview.html" class="">分布式概述</a></li>
                                <li><a href="../../distributedPage/zookeeper_overview.html" class="">ZooKeeper概述</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="#designPatternsPage" data-toggle="collapse" class="collapsed"><i class="lnr lnr-laptop"></i> <span>设计模式</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                        <div id="designPatternsPage" class="collapse ">
                            <ul class="nav">
                                <li><a href="../../designPatternsPage/six_principles.html" class="">六大原则</a></li>
                                <li><a href="../../designPatternsPage/singleton_pattern.html" class="">单例模式</a></li>
                                <li><a href="../../designPatternsPage/factory_method_pattern.html" class="">工厂方法模式</a></li>
                                <li><a href="../../designPatternsPage/abstract_factory_pattern.html" class="">抽象工厂模式</a></li>
                                <li><a href="../../designPatternsPage/template_method_pattern.html" class="">模板方法模式</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a id="database_page_button" href="#databasePage" data-toggle="collapse" class="collapsed"><i class="lnr lnr-database"></i> <span>数据库</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                        <div id="databasePage" class="collapse ">
                            <ul class="nav">
                                <li><a href="../mysql-basic-knowledge.html" class="">基础知识</a></li>
                                <li>
                                    <a href="#advanced_knowledge" data-toggle="collapse" class="collapsed"><span>进阶知识</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                                    <div id="advanced_knowledge" class="collapse ">
                                        <ul class="nav">
                                            <li><a href="../mysql-advanced-knowledge/mysql-advanced-knowledge-index.html" class=""><i class="lnr"></i>索引</a></li>
                                            <li><a href="../mysql-advanced-knowledge/mysql-advanced-knowledge-view.html" class=""><i class="lnr"></i>视图</a></li>
                                            <li><a href="../mysql-advanced-knowledge/mysql-advanced-knowledge-stored-procedure.html" class=""><i class="lnr"></i>存储过程</a></li>
                                            <li><a href="../mysql-advanced-knowledge/mysql-advanced-knowledge-trigger.html" class=""><i class="lnr"></i>触发器</a></li>
                                        </ul>
                                    </div>
                                </li>
                                <li>
                                    <a id="database_page_high_level_button" href="#high_level_knowledge" data-toggle="collapse" class="collapsed"><span>高阶知识</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
                                    <div id="high_level_knowledge" class="collapse ">
                                        <ul class="nav">
                                            <li><a href="mysql-high-level-knowledge-authority-and-security-management.html" class=""><i class="lnr"></i>权限与安全管理</a></li>
                                            <li><a href="mysql-high-level-knowledge-database-backup-and-recovery.html" class=""><i class="lnr"></i>数据库备份与恢复</a></li>
                                            <li><a href="mysql-high-level-knowledge-mysql-log-and-performance-optimization.html" class="active"><i class="lnr"></i>MySQL日志与性能优化</a></li>
                                        </ul>
                                    </div>
                                </li>
                                <li><a href="../mysql-sub-database_sub-table.html" class="">分库分表</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <!-- END LEFT SIDEBAR -->
    <!-- MAIN -->
    <div class="main">
        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="container-fluid">
                <h3 class="page-title tinyHand" onclick="mysqlLogAndPerformanceOptimizationTips()">MySQL日志与性能优化 <i class="fa fa-hand-pointer-o"></i></h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="logClassificationTips()">日志分类 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div id="log_classification" style="height:500%;"></div>
                                <h3 class="panel-title tinyHand" onclick="logClassificationIsMoreDetailedTips()">查看MySQL 8.0的日志新特性——日志分类更详细 <i class="fa fa-hand-pointer-o"></i></h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="analyzeQueryStatementsTips()">分析查询语句 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div id="analyze_query_statements" style="height:500%;"></div>
                                <h3 class="panel-title tinyHand" onclick="optimizeSubqueriesTips()">优化子查询 <i class="fa fa-hand-pointer-o"></i></h3>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="optimizeDatabaseStructureTips()">优化数据库结构 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div id="optimize_database_structure" style="height:500%;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title tinyHand" onclick="optimizeMysqlServerTips()">优化MySQL服务器 <i class="fa fa-hand-pointer-o"></i></h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div id="optimize_mysql_server" style="height:500%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel panel-scrolling panel-success">
                            <div class="panel-heading">
                                <h3 class="panel-title">临时表性能优化</h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <p class="firstLineIndent">在MySQL 8.0中，用户可以把数据库和表归组到逻辑和物理表空间中，这样做可以提高资源的利用率。</p>
                                <p class="firstLineIndent">
                                    MySQL 8.0使用<code>CREATE TABLESPACE</code>语句来创建一个<b>通用表空间</b>。这个功能可以让用户自由地选择表和表空间之间的映射。例如，创建表空间
                                    和设置这个表空间应该含有什么样的表。这也让在同一个表空间的用户对所有的表分组，因此在文件系统一个单独的文件内持有他们所有的数据，同时为通用表空间实
                                    现了<b>元数据锁</b>。
                                </p>
                                <p class="firstLineIndent">
                                    优化普通SQL临时表性能是MySQL 8.0的目标之一。首先，通过优化临时表在磁盘中的不必要步骤，使得临时表的创建和移除成为一个轻量级的操作。将临时表移动到一
                                    个单独的表空间中，恢复临时表的过程就变得非常简单，就是在启动时重新创建临时表的单一过程。
                                </p>
                                <p class="firstLineIndent">
                                    MySQL 8.0去掉了临时表中不必要的持久化。临时表仅仅在连接和会话内被创建，然后通过服务的生命周期绑定它们。通过移除不必要的UNDO和REDO日志，改变缓冲和
                                    锁，从而为临时表做了优化操作。
                                </p>
                                <p class="firstLineIndent">
                                    MySQL 8.0增加了UNDO日志一个额外的类型，这个类型的日志被保存在一个单独的临时表空间中，在恢复期间不会被调用，而是在回滚操作中才会被调用。
                                </p>
                                <p class="firstLineIndent">
                                    MySQL 8.0为了提高临时表相关的性能，对临时表相关的部分进行了大幅修改，包括引入新的临时表空间（ibtmp1）；对于临时表的DDL，不持久化相关表定义；对于
                                    临时表的DML，不写redo、关闭change buffer等。
                                </p>
                                <p class="firstLineIndent">
                                    InnoDB临时表元数据不再存储于InnoDB系统表，而是存储在<code>innodb_temp_table_info</code>中，包含所有用户和系统创建的临时表信息。该表在第一次运行
                                    SELECT时被创建，下面举例说明。
                                </p>
                                <pre>
                                    <code class="sql">
    mysql> SELECT * FROM information_schema.innodb_temp_table_info;
    Empty set (0.00 sec)
    mysql>
    mysql>
    mysql> CREATE TEMPORARY TABLE temp_1(
        -> id int,
        -> name varchar(100)
        -> ) DEFAULT CHARSET UTF8;
    Query OK, 0 rows affected (0.00 sec)
    mysql> SELECT * FROM information_schema.innodb_temp_table_info;
    +----------+---------------+--------+------------+
    | TABLE_ID |      NAME     | N_COLS |   SPACE    |
    +----------+---------------+--------+------------+
    |   1065   | #sql11060_8_8 |    5   | 4294566162 |
    +----------+---------------+--------+------------+
    1 row in set (0.00 sec)
                                    </code>
                                </pre>
                                <p class="firstLineIndent">
                                    MySQL 8.0使用了独立的临时表空间来存储临时表数据，但不能是压缩表。临时表空间在实例启动的时候进行创建、shutdown的时候进行删除，即为所有非压缩的innodb临时表
                                    提供了一个独立的表空间。默认的临时表空间文件为<b>ibtmp1</b>，位于数据目录中。通过<code>innodb_temp_data_file_path</code>参数可指定临时表空间的路径和大小，
                                    默认为<b>12MB</b>。只有重启实例才能回收临时表空间文件ibtmp1的大小。<code>CREATE TEMPORARY</code>和<code>USING TEMPORARY TABLE</code>将共用这个临时表文件。
                                </p>
                                <pre>
                                    <code class="sql">
    mysql> SHOW VARIABLES LIKE 'innodb_temp_data_file_path';
    mysql> SELECT * FROM information_schema.innodb_temp_table_info;
    +----------------------------+-----------------------+
    |       Variable_name        |         Value         |
    +----------------------------+-----------------------+
    | innodb_temp_data_file_path | ibtmp1:12M:autoextend |
    +----------------------------+-----------------------+
    1 row in set, 1 warning (0.00 sec)
                                    </code>
                                </pre>
                                <p class="firstLineIndent">
                                    在MySQL 8.0中，临时表在连接断开或者数据库实例关闭的时候会进行删除，从而提高了性能。只有临时表的元数据使用了redo保护，保护元数据的完整性，以便异常启动后进行清理工作。
                                </p>
                                <p class="firstLineIndent">
                                    临时表的元数据在MySQL 8.0之后使用了一个独立的表（<code>innodb_temp_table_info</code>）进行保存，不用使用redo保护，元数据也只保存在内存中。但这有一个前提，
                                    即必须使用共享的临时表空间，如果使用<code>file-per-table</code>，仍然需要持久化元数据，以便异常恢复清理。临时表需要undo log，用于MySQL运行时的回滚。
                                </p>
                                <p class="firstLineIndent">
                                    在MySQL 8.0中，新增一个系统选项<code>internal_tmp_disk_storage_engine</code>，可定义磁盘临时表的引擎类型，默认为InnoDB，可选MyISAM。在这之前，只能使用
                                    MyISAM。在MySQL 5.6.3以后新增的参数<code>default_tmp_storage_engine</code>是控制<code>CREATE TEMPORARY TABLE</code>创建的临时表存储引擎，在以前默认是
                                    MEMORY。
                                </p>
                                <p class="firstLineIndent">查看结果如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> SHOW VARIABLES LIKE '%engine%';
    mysql> SELECT * FROM information_schema.innodb_temp_table_info;
    +----------------------------------+-----------+
    |           Variable_name          |   Value   |
    +----------------------------------+-----------+
    | default_storage_engine           | InnoDB    |
    | default_tmp_storage_engine       | InnoDB    |
    | disabled_storage_engines         |           |
    | internal_tmp_disk_storage_engine | InnoDB    |
    | internal_tmp_mem_storage_engine  | TempTable |
    | use_secondary_engine             | ON        |
    +----------------------------------+-----------+
    6 rows in set (0.09 sec)
                                    </code>
                                </pre>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-scrolling panel-info">
                            <div class="panel-heading">
                                <h3 class="panel-title">服务器语句超时处理与创建全局通用表空间</h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <p class="fa fa-fire"> 服务器语句超时处理</p>
                                <p class="firstLineIndent">在MySQL 8.0中可以设置服务器语句超时的限制，单位可以达到<b>毫秒级别</b>。</p>
                                <p class="firstLineIndent">当中断的执行语句超过设置的毫秒数后，服务器将终止查询影响不大的事务或连接，然后将错误报给客户端。</p>
                                <p class="firstLineIndent">设置服务器语句超时的限制，可以通过设置全局变量<code>MAX_EXECUTION_TIME</code>来实现，例如：</p>
                                <p class="firstLineIndent"><code>SET GLOBAL MAX_EXECUTION_TIME = 2000;</code></p>
                                <p class="firstLineIndent">默认情况下，<code>MAX_EXECUTION_TIME</code>的值为0，代表没有时间限制。通过上述设置后，如果SELECT语句执行超过2000毫秒，语句将会被终止。</p>
                                <p class="firstLineIndent">设置服务器语句超时的限制，也可以通过设置会话变量<code>MAX_EXECUTION_TIME</code>来实现。该变量用于设置SELECT语句运行在一个特定的会话里，指定该会话的超时时间，例如：</p>
                                <p class="firstLineIndent"><code>SET SESSION MAX_EXECUTION_TIME = 2000;</code></p>
                                <p class="firstLineIndent">通过上述设置后，如果SELECT语句执行超过2000毫秒，会话将会被终止。</p>
                                <hr>
                                <p class="fa fa-fire"> 创建全局通用表空间</p>
                                <p class="firstLineIndent">
                                    MySQL 8.0支持创建全局通用表空间，全局表空间可以被所有数据库的表共享，而且相比于独享表空间，手动创建共享表空间可以节约元数据方面的内存。可以在创建表的时候指定
                                    属于哪个表空间，也可以对已有表进行表空间修改，具体的信息可以查看官方文档。
                                </p>
                                <p class="firstLineIndent">下面创建名为dxy的共享表空间，SQL语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> CREATE TABLESPACE dxy ADD datafile 'dxy.ibd' file_block_size = 16k;
    Query OK, 0 rows affected (0.10 sec)
                                    </code>
                                </pre>
                                <p class="firstLineIndent">指定表空间，SQL语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> CREATE TABLE t1(
    -> id int,
    -> name varchar(10)
    -> ) ENGINE = innodb default charset uf8mb4 TABLESPACE dxy;
    Query OK, 0 rows affected (0.01 sec)
                                    </code>
                                </pre>
                                <p class="firstLineIndent">也可以通过<code>ALTER TABLE</code>语句指定表空间，SQL语句如下</p>
                                <pre>
                                    <code class="sql">
    mysql> ALTER TABLE t1 TABLESPACE dxy;
                                    </code>
                                </pre>
                                <p class="firstLineIndent">
                                    如何删除创建的共享表空间？因为是共享表空间，所以不能直接通过<code>DROP TABLE tbname</code>来删除，也不能回收空间。当确定共享表空间的数据都没用并且依赖该表空间的表均已经删除时，可以通过<code>DROP TABLESPACE</code>
                                    来删除共享表空间，以释放空间，如果依赖该共享表空间的表存在就会删除失败。
                                </p>
                                <p class="firstLineIndent">首先，删除依赖该表空间的数据表，SQL语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> DROP TABLE t1;
    Query OK, 0 rows affected (0.16 sec)
                                    </code>
                                </pre>
                                <p class="firstLineIndent">最后，删除表空间，SQL语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> DROP TABLESPACE dxy;
    Query OK, 0 rows affected (0.01 sec)
                                    </code>
                                </pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel panel-scrolling panel-danger">
                            <div class="panel-heading">
                                <h3 class="panel-title">MySQL 8.0的新特性1——支持不可见索引</h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <p class="firstLineIndent">
                                    不可见索引的特性对于性能调试非常有用。在MySQL 8.0中，索引可以被”隐藏“和”显示“。当一个索引被隐藏时，它不会被查询优化器所使用。也就是说，管理员可以隐藏一个索引，然后观察
                                    对数据库的影响。如果数据库性能有所下降，就说明这个索引是有用的，于是将其”恢复显示“即可；如果数据库性能看不出变化，说明这个索引是多余的，可以删掉了。
                                </p>
                                <p class="firstLineIndent">下面通过一个案例来了解如何隐藏和显示索引。</p>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                                <p class="firstLineIndent">创建不可见索引，执行语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> CREATE TABLE test1(
        -> a int,
        -> b int,
        -> index idx_a_b(a,b desc) INVISIBLE
        -> );
                                    </code>
                                </pre>
                                <p class="firstLineIndent">查看索引idx_a_b的属性Visible的值，执行语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> SHOW INDEX FROM test1 \G;
    ************************** 1.row ***************************
                        Table: test1
                   Non_unique: 1
                     Key_name: idx_a_b
                 Seq_in_index: 2
                  Column_name: b
                    Collation: D
                  Cardinality: 0
                     Sub_part: NULL
                       Packed: NULL
                         Null: YES
                   Index_type: BTREE
                      Comment:
                Index_comment:
                      Visible: NO
                   Expression: NULL
                                    </code>
                                </pre>
                                <p class="firstLineIndent">从结果可以看出，Visible的属性值为<b>NO</b>。</p>
                                <p class="firstLineIndent">显示不可见索引，执行语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> ALTER TABLE test1 ALTER index idx_a_b VISIBLE;
    Query OK, 0 rows affected (0.10 sec)
    Records: 0 Duplicates: 0 Warnings: 0
                                    </code>
                                </pre>
                                <p class="firstLineIndent">再次查看索引idx_a_b的属性Visible的值，执行语句如下:</p>
                                <pre>
                                    <code class="sql">
    mysql> SHOW INDEX FROM test1 \G;
    ************************** 1.row ***************************
                        Table: test1
                   Non_unique: 1
                     Key_name: idx_a_b
                 Seq_in_index: 2
                  Column_name: b
                    Collation: D
                  Cardinality: 0
                     Sub_part: NULL
                       Packed: NULL
                         Null: YES
                   Index_type: BTREE
                      Comment:
                Index_comment:
                      Visible: YES
                   Expression: NULL
                                    </code>
                                </pre>
                                <p class="firstLineIndent">从结果可以看出，Visible的属性值为YES。</p>
                                <p class="firstLineIndent">
                                    <span class="note">注意</span>：当索引被隐藏时，它的内容仍然是和正常索引一样实时更新的。如果一个索引需要长期被隐藏，那么可以将其删除，因为索引的存在会影响插入、
                                    更新和删除的性能。
                                </p>
                                <p class="firstLineIndent">再次隐藏索引，执行语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> ALTER TABLE test1 ALTER index idx_a_b INVISIBLE;
    Query OK, 0 rows affected (0.07 sec)
    Records: 0 Duplicates: 0 Warnings: 0
                                    </code>
                                </pre>
                                <p class="firstLineIndent"><span class="note">注意</span>：数据表中的主键不能被设置为INVISIBLE。</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-scrolling panel-warning">
                            <div class="panel-heading">
                                <h3 class="panel-title">MySQL 8.0的新特性2——增加资源组</h3>
                                <div class="right">
                                    <button type="button" class="btn-toggle-collapse" title="向上折叠"><i class="lnr lnr-chevron-up"></i></button>
                                    <button type="button" class="btn-remove" title="关闭"><i class="lnr lnr-cross"></i></button>
                                </div>
                            </div>
                            <div class="panel-body">
                                <p class="firstLineIndent">MySQL 8.0新增了一个资源组功能，用于调控线程优先级以及绑定CPU。MySQL用户需要有<code>RESOURCE_GROUP_ADMIN</code>权限才能创建、修改、删除资源组。</p>
                                <p class="firstLineIndent"><span class="note">注意</span>：在Linux环境下，MySQL进程需要有<code>CAP_SYS_NICE</code>权限才能使用资源组的完整功能。</p>
                                <pre>
                                    <code class="sql">
    [root@localhost~]# sudo setcap cap_sys_nice+ep /usr/local/mysql8.0/bin/mysqld
    [root@localhost~]# getcap /usr/local/mysql8.0/bin/mysqld /usr/local/mysql8.0/bin/mysqld = cap_sys_nice+ep
                                    </code>
                                </pre>
                                <p class="firstLineIndent">MySQL 8.0默认提供两个资源组，分别是<code>USR_DEFAULT</code>和<code>SYS_DEFAULT</code>。下面来讲述关于资源组的常用操作。</p>
                                <hr>
                                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                                <p class="firstLineIndent">创建名称为my_resource_group的资源组，执行语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> CREATE RESOURCE GROUP my_resource_group type = USER vcpu = 0,1 thread_priority = 5;
    Query OK, 0 rows affected (0.07 sec)
                                    </code>
                                </pre>
                                <p class="firstLineIndent">将当前线程加入资源组：</p>
                                <pre>
                                    <code class="sql">
    mysql> SET RESOURCE GROUP my_resource;
    Query OK, 0 rows affected (0.07 sec)
                                    </code>
                                </pre>
                                <p class="firstLineIndent">查看资源组my_resource_group中包含的线程，执行语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> SELECT * FROM Performance_Schema.threads WHERE RESOURCE_GROUP = 'my_resource_group' \G;
    ********************************* 1.row ************************************
                            THREAD_ID: 48
                                 NAME: thread/sql/one_connection
                                 TYPE: FOREGROUND
                       PROCESSLIST_ID: 9
                     PROCESSLIST_USER: root
                     PROCESSLIST_HOST: localhost
                       PROCESSLIST_DB: mysql
                  PROCESSLIST_COMMAND: Query
                     PROCESSLIST_TIME: 0
                    PROCESSLIST_STATE: Sending
                     PROCESSLIST_INFO: RESOURCE_GROUP='my_resource_group'
                     PARENT_THREAD_ID: NULL
                                 ROLE: NULL
                         INSTRUMENTED: YES
                              HISTORY: YES
                     CONNECTIONS_TYPE: SSL/TLS
                         THREAD_OS_ID: 1352
                       RESOURCE_GROUP: my_resource_group
                                    </code>
                                </pre>
                                <p class="firstLineIndent">资源组里有线程时，删除资源组会报错：</p>
                                <pre>
                                    <code class="sql">
    mysql> DROP RESOURCE group my_resource_group;
    ERROR 3656 (HY000): Resource group my_resource_group is busy.
                                    </code>
                                </pre>
                                <p class="firstLineIndent">修改资源组的语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> ALTER RESOURCE group my_resource_group vcpu = 2,3 THREAD_PRIORITY = 8;
    Query OK, 0 rows affected (0.10 sec)
                                    </code>
                                </pre>
                                <p class="firstLineIndent">把资源组里的线程移出到默认资源组USR_DEFAULT中，执行语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> SET RESOURCE GROUP USR_DEFAULT FOR 48;
    Query OK, 0 rows affected (0.00 sec)
                                    </code>
                                </pre>
                                <p class="firstLineIndent">删除资源组的语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> DROP RESOURCE GROUP my_resource_group;
    Query OK, 0 rows affected (0.08 sec)
                                    </code>
                                </pre>
                                <p class="firstLineIndent">如果需要指定线程的ID，可以使用以下语句：</p>
                                <p class="firstLineIndent"><code>SET RESOURCE GROUP my_resource_group FOR thread_id;</code></p>
                                <p class="firstLineIndent">这里的thread_id为线程的ID。查询线程ID的方法如下：</p>
                                <p class="firstLineIndent"><code>SELECT thread_id FROM Performance_Schema.threads;</code></p>
                                <p class="firstLineIndent">例如，将ID为20的线程加入到资源组my_resource_group中，语句如下：</p>
                                <pre>
                                    <code class="sql">
    mysql> SET RESOURCE GROUP my_resource_group FOR 20;
    Query OK, 0 rows affected (0.02 sec)
                                    </code>
                                </pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END MAIN CONTENT -->
    </div>
    <!-- END MAIN -->
    <div class="clearfix"></div>
    <footer>
        <div class="container-fluid">
            <p class="copyright">Copyright &copy; https://github.com/KevenPotter/KevenPotterInterview <a href="https://github.com/KevenPotter/KevenPotterInterview" target="_blank" title="KevenPotter">KevenPotter</a> - Collect from <a href="https://github.com/KevenPotter" title="Github"
                                                                                                                                                                                                                                          target="_blank">KevenPotter主页</a></p>
        </div>
    </footer>
</div>
<!-- END WRAPPER -->

<!-- mysql日志与性能优化提示 -->
<div id="mysql_log_and_performance_optimization_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">MySQL日志与性能优化</h3>
    </div>
    <div class="panel-body">
        <p class="fa fa-fire"> MySQL日志</p>
        <p class="firstLineIndent">MySQL日志记录了MySQL数据库日常操作和错误信息。MySQL有不同类型的日志文件（各自存储了不同类型的日志），从日志当中可以查询到MySQL数据库的运行情况、用户操作、错误信息等，可以为MySQL管理和优化提供必要的信息。对于MySQL的管理工作而言，这些日志文件是不可缺少的。</p>
        <p class="fa fa-fire"> 性能优化</p>
        <p class="firstLineIndent">
            优化MySQL数据库是数据库管理员和数据库开发人员的必备技能。MySQL优化，一方面是找出系统的瓶颈，提高MySQL数据库整体的性能；另一方面需要合理的结构设计和参数调整，以提高用户操作响应速度；同时
            还要尽可能节省系统资源，以便系统可以提供更大负荷的服务。
        </p>
        <p class="firstLineIndent">MySQL数据库优化是多方面的，原则是减少系统的瓶颈，减少资源的占用，增加系统的反应速度。例如，通过优化文件系统，提高磁盘I/O的读写速度；通过优化操作系统调度策略，提高MySQL在高负荷情况下的负载能力；优化表结构、索引、查询语句等使查询响应更快。</p>
        <p class="firstLineIndent">在MySQL中，可以使用<code>SHOW STATUS</code>语句查询一些MySQL数据库的性能参数。SHOW STATUS语句的语法如下：</p>
        <p class="firstLineIndent"><code class="firstLineIndent">SHOW STATUS LIKE 'value';</code></p>
        <p class="firstLineIndent">其中，value是要查询的参数值，一些常用的性能参数如下：</p>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>Connections</td>
                <td>连接MySQL服务器的次数</td>
            </tr>
            <tr>
                <td>Uptime</td>
                <td>MySQL服务器的上线时间</td>
            </tr>
            <tr>
                <td>Slow_queries</td>
                <td>慢查询的次数</td>
            </tr>
            <tr>
                <td>Com_select</td>
                <td>查询操作的次数</td>
            </tr>
            <tr>
                <td>Com_insert</td>
                <td>插入操作的次数</td>
            </tr>
            <tr>
                <td>Com_update</td>
                <td>更新操作的次数</td>
            </tr>
            <tr>
                <td>Com_delete</td>
                <td>删除操作的次数</td>
            </tr>
            </tbody>
        </table>
        <p class="firstLineIndent">查询MySQL服务器的连接次数，可以执行如下语句：</p>
        <p class="firstLineIndent"><code>SHOW STATUS LIKE 'Connections';</code></p>
        <p class="firstLineIndent">查询MySQL服务器的慢查询次数，可以执行如下语句：</p>
        <p class="firstLineIndent"><code>SHOW STATUS LIKE 'Slow_queries';</code></p>
        <p class="firstLineIndent">查询其他参数的方法和两个参数的查询方法相同。慢查询次数参数可以结合慢查询日志，找出慢查询语句，然后针对慢查询语句进行表结构优化或者查询语句优化。</p>
    </div>
</div>

<!-- 日志分类提示 -->
<div id="log_classification_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">日志分类</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">MySQL日志主要分为4类，使用这些日志文件，可以查看MySQL内部发生的事情。这4类日志分别是：</p>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>日志</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>错误日志</td>
                <td>记录MySQL服务的启动、运行或停止MySQL服务时出现的问题</td>
            </tr>
            <tr>
                <td>查询日志</td>
                <td>记录建立的客户端连接和执行的语句</td>
            </tr>
            <tr>
                <td>二进制日志</td>
                <td>记录所有更改数据的语句，可以用于数据复制</td>
            </tr>
            <tr>
                <td>慢查询日志</td>
                <td>记录所有执行时间超过<b>long_query_time</b>的所有查询或不使用索引的查询</td>
            </tr>
            </tbody>
        </table>
        <p class="firstLineIndent">
            默认情况下，所有日志创建于MySQL数据目录中。通过刷新日志，可以强制MySQL关闭和重新打开日志文件（或者在某些情况下切换到一个新的日志）。当执行一个<code>FLUSH LOGS</code>语句或执行
            <code>mysqladmin flush-logs</code>或<code>mysqladmin refresh</code>时，将刷新日志。
        </p>
        <p class="firstLineIndent">如果正使用MySQL复制功能，在复制服务器上可以维护更多日志文件，这种日志称为<b>接替日志</b>。</p>
        <p class="firstLineIndent"><b>启动日志功能会降低MySQL数据库的性能。</b>例如，在查询非常频繁的MySQL数据库系统中，如果开启了通用查询日志和慢查询日志，MySQL数据库会花费很多时间记录日志。同时，日志会占用大量的磁盘空间。</p>
    </div>
</div>

<!-- 日志分类-二进制日志 -->
<div id="log_classification_binary_log" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title tinyHand" onclick="logClassificationBinaryLogTips()">二进制日志 <i class="fa fa-hand-pointer-o"></i></h3>
    </div>
    <div class="panel-body">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#log_classification_binary_log_1" data-toggle="tab">启动和设置二进制日志</a></li>
            <li><a href="#log_classification_binary_log_2" data-toggle="tab">查看二进制日志</a></li>
            <li class="dropdown">
                <a href="#" id="log_classification_binary_log_3" class="dropdown-toggle" data-toggle="dropdown">删除二进制日志<b class="caret"></b></a>
                <ul class="dropdown-menu" role="menu" aria-labelledby="log_classification_binary_log_3">
                    <li><a href="#log_classification_binary_log_3_1" tabindex="-1" data-toggle="tab">使用RESET MASTER语句删除所有二进制日志文件</a></li>
                    <li><a href="#log_classification_binary_log_3_2" tabindex="-1" data-toggle="tab">使用PURGE MASTER LOGS语句删除指定日志文件</a></li>
                </ul>
            </li>
            <li><a href="#log_classification_binary_log_4" data-toggle="tab">使用二进制日志恢复数据库</a></li>
            <li><a href="#log_classification_binary_log_5" data-toggle="tab">暂时停止二进制日志功能</a></li>
        </ul>
        <div class="tab-content">
            <div id="log_classification_binary_log_1" class="tab-pane fade in active">
                <p class="firstLineIndent">默认情况下，二进制日志是开启的，可以通过修改MySQL的配置文件来启动和设置二进制日志。</p>
                <p class="firstLineIndent">my.ini中[mysqld]组下面有关于二进制日志的设置：</p>
                <p class="firstLineIndent"><b>log-bin [=path/ [filename]]</b></p>
                <hr>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>参数</th>
                        <th>作用</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>log-bin [=path/ [filename]]</td>
                        <td class="tinyHand" onclick="logClassificationBinaryLog1LogBinTips()">定义开启二进制日志 <i class="fa fa-hand-pointer-o"></i></td>
                    </tr>
                    <tr>
                        <td>expire_logs_days</td>
                        <td>定义了MySQL清除过期日志的时间，即二进制日志自动删除的天数。默认值为0，表示“没有自动删除”。当MySQL启动或刷新二进制日志时可能删除该文件</td>
                    </tr>
                    <tr>
                        <td>max_binlog_size</td>
                        <td>
                            定义了单个文件的大小限制，如果二进制日志写入的内容大小超出给定值，日志就会发生滚动（关闭当前文件，重新打开一个新的日志文件）。<b>不能将该变量设置为大于1GB或小于4096B，默认值是1GB</b>。
                            如果正在使用大的事务，二进制日志文件大小还可能会超过max_binlog_size定义的大小
                        </td>
                    </tr>
                    </tbody>
                </table>
                <p class="firstLineIndent">在my.ini配置文件中的[mysqld]组下，添加以下几个参数与参数值</p>
                <pre>
                    <code class="sql">
    [mysqld]
    log-bin
    expire_logs_days = 10
    max_binlog_size = 100M
                    </code>
                </pre>
                <p class="firstLineIndent">添加完毕后，关闭并重新启动MySQL服务进程，即可打开二进制日志，然后可以通过<code>SHOW VARIABLES</code>语句来查询日志设置。</p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用SHOW VARIABLES语句查询日志设置，执行的语句及结果如下：</p>
                <pre>
                    <code class="sql">
    mysql> SHOW VARIABLES LIKE 'log_%';
    +------------------------------------------+-------------------------------------------------------------------------+
    | Variable_name                            |  Value                                                                  |
    +------------------------------------------+-------------------------------------------------------------------------+
    | log_bin                                  | ON                                                                      |
    | log_bin_basename                         | C:\ProgramData\MySQL\MySQL Server 8.0\Data\X0NHUMO7YDZVSST-bin          |
    | log_bin_index                            | C:\ProgramData\MySQL\MySQL Server 8.0\Data\X0NHUMO7YDZVSST-bin.index    |
    | log_bin_trust_function_creators          | OFF                                                                     |
    | log_bin_use_v1_row_events                | OFF                                                                     |
    | log_error                                | .\X0NHUMO7YDZVSSI.err                                                   |
    | log_error_services                       | log_filter_internal;log_sink_internal                                   |
    | log_error_suppression_list               |                                                                         |
    | log_error_verbosity                      | 2                                                                       |
    | log_output                               | FILE                                                                    |
    | log_queries_not_using_indexed            | OFF                                                                     |
    | log_slave_updates                        | ON                                                                      |
    | log_slow_admin_statements                | OFF                                                                     |
    | log_slow_slave_statements                | OFF                                                                     |
    | log_statements_unsafe_for_binlog_indexes | ON                                                                      |
    | log_throttle_queries_not_using_indexes   | 0                                                                       |
    | log_timestamps                           | UTC                                                                     |
    +------------------------------------------+-------------------------------------------------------------------------+
                    </code>
                </pre>
                <p class="firstLineIndent">通过上面的查询结果可以看出，log_bin变量的值为ON，表明二进制日志已经打开。MySQL重新启动之后，可以在自己的机器上的MySQL数据文件夹下面看到新生成的文件后缀为.000001和.index的两个文件，文件名称为默认主机名称。</p>
                <p class="firstLineIndent"><span class="note">注意</span>：数据库文件最好不要与日志文件放在同一个磁盘上，这样当数据库文件所在的磁盘发生故障时，可以使用日志文件恢复数据。</p>
            </div>
            <div id="log_classification_binary_log_2" class="tab-pane fade">
                <p class="firstLineIndent">
                    MySQL二进制日志存储了所有的变更信息，MySQL二进制日志是经常用到的。当MySQL创建二进制日志文件时，先创建一个以“filename”为名称、以“.index”为后缀的文件，再创建一个以“filename”为名称、
                    以“.000001”为后缀的文件。MySQL服务重新启动一次，以“.000001”为后缀的文件会增加一个，并且后缀名加1递增；如果日志长度超过了max_binlog_size的上限（默认是1GB），就会创建一个新的日志文件。
                </p>
                <p class="firstLineIndent"><code>SHOW BINARY LOGS</code>语句可以查看当前的二进制日志文件个数及其文件名。MySQL二进制日志并不能直接查看，如果要查看日志内容，可以通过<code>mysqlbinlog</code>命令查看。</p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用SHOW BINARY LOGS查看二进制日志文件个数及文件名，执行命令及结果如下：</p>
                <pre>
                    <code class="sql">
    mysql> SHOW BINARY LOGS;
    +------------------------------+-----------+
    |             Log_name         | File_size |
    +------------------------------+-----------+
    |  X0NHUNO7YDZVSSI-bin.000001  |    178    |
    +------------------------------+-----------+
    1 row in set (0.00 sec)
                    </code>
                </pre>
                <p class="firstLineIndent">可以看到，当前只有一个二进制日志文件。日志文件的个数与MySQL服务启动的次数相同。每启动一次MySQL服务，将会产生一个新的日志文件。</p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用mysqlbinlog查看二进制日志，执行命令及结果如下：</p>
                <pre>
                    <code class="sql">
    C:\ >mysqlbinlog D:/mysql/log/binlog.000001
    /*!40019 SET @@session.max_insert_delayed_threads=0*/;
    /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;
    DELIMITER /*!*/;
    # at 4
    #190130 15:27:48 server id 1 end_log_pos 107 Start: binlog v 4, server v 8.0.13-log created 160330
    # Warning: this binlog is either in use or was not closed properly.
    ROLLBACK/*!*/;
    BINLOG '
    9JBcTg8BAAAAZwAAAGsAAAABAAQANS41LjEzLWXxvZwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
    AAAAAAAAAAAAAAAAAAD0kFxOEzgNAAgAEgAEBAQEEgAAVAAEggAAAAICAgCAA==
    '/*!*/;
    # at 107
    #190330 15:34:17 server id 1 end_log_pos 175 thread_id=2 exec_time=0
    error_code=0
    SET TIMESTAMP=1314689657/*!*/;
    SET @@session.pseudo_thread_id=2/*!*/;
    SET @@session.foreign_key_checks=1,@@session.sql_auto_is_null=0,@@session.unique_checks=1,
    @@session
    SET @@session.sql_mode=0/*!*/;
    SET @@session.auto_increment_increment=1,@@session.auto_increment_offset=1/*!*/;
    /*!\C gb2312 *//*!*/;
    SET @@session.character_set_client=24,@@session.collation_connection=24,@@session.collation_server=24/
    SET @@session.lc_time_names=0/*!*/;
    SET @@session.collation_database=DEFAULT/*!*/;
    BEGIN
    /*!*/;
    # at 175
    #190130 15:34:17 server id 1 end_log_pos 289 Query thread_id=2 exec_time=0
    use test/*!*/;
    SET TIMESTAMP=1314689657/*!*/;
    UPDATE fruits set f_price = 5.00 WHERE f_id = 'a1'
    /*!*/;
    # at 289
    #190330 15:34:17 server id 1 end_log_pos 316 Xid = 14
    COMMIT/*!*/;
    DELIMITER ;
    # End of log file
    ROLLBACK /* added by mysqlbinlog */
    /*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;
                    </code>
                </pre>
                <p class="firstLineIndent">这是一个简单的日志文件，日志中记录了一些用户的操作。从文件内容中可以看到，用户对fruits表进行了更新操作，语句为“UPDATE fruits SET f_price = 5.00 WHERE f_id = 'a1';”。</p>
            </div>
            <div id="log_classification_binary_log_3_1" class="tab-pane fade">
                <p class="firstLineIndent">MySQL的二进制文件可以配置自动删除，同时MySQL也提供了安全的手动删除二进制文件的方法：<code>RESET MASTER</code>删除所有的二进制日志文件；<code>PURGE MASTER LOGS</code>只删除部分二进制日志文件。</p>
                <p class="firstLineIndent">RESET MASTER语法如下：</p>
                <p class="firstLineIndent"><code>RESET MASTER;</code></p>
                <p class="firstLineIndent">执行完该语句后，所有二进制日志将被删除，MySQL会重新创建二进制日志，新的日志文件扩展名将重新从000001开始编号。</p>
            </div>
            <div id="log_classification_binary_log_3_2" class="tab-pane fade">
                <p class="firstLineIndent">MySQL的二进制文件可以配置自动删除，同时MySQL也提供了安全的手动删除二进制文件的方法：<code>RESET MASTER</code>删除所有的二进制日志文件；<code>PURGE MASTER LOGS</code>只删除部分二进制日志文件。</p>
                <p class="firstLineIndent">PURGE MASTER LOGS语法如下：</p>
                <p class="firstLineIndent"><code>PURGE {MASTER | BINARY} LOGS TO 'log_name';</code></p>
                <p class="firstLineIndent"><code>PURGE {MASTER | BINARY} LOGS BEFORE 'date';</code></p>
                <p class="firstLineIndent">第1种方法指定文件名，执行该命令将删除文件名编号比指定文件名编号小的所有日志文件。第2种方法指定日期，执行该命令将删除指定日期以前的所有日志文件。</p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用PURGE MASTER LOGS删除创建时间比X0NHUNO7YDZVSSI-bin.000003早的所有日志文件：</p>
                <pre>
                    <code class="sql">
    mysql> SHOW BINARY LOGS;
    +------------------------------+-----------+
    |             Log_name         | File_size |
    +------------------------------+-----------+
    |  X0NHUNO7YDZVSSI-bin.000001  |    178    |
    |  X0NHUNO7YDZVSSI-bin.000002  |    641    |
    |  X0NHUNO7YDZVSSI-bin.000003  |    345    |
    +------------------------------+-----------+
    3 rows in set (0.01 sec)
    mysql>
    mysql>
    mysql> PURGE MASTER LOGS TO "X0NHUNO7YDZVSSI-bin.000003";
    Query OK, 0 rows affected (0.07 sec)
    mysql>
    mysql>
    mysql> SHOW BINARY LOGS;
    +------------------------------+-----------+
    |             Log_name         | File_size |
    +------------------------------+-----------+
    |  X0NHUNO7YDZVSSI-bin.000003  |    345    |
    +------------------------------+-----------+
                    </code>
                </pre>
                <p class="firstLineIndent">可以看到，X0NHUNO7YDZVSSI-bin.000001、X0NHUNO7YDZVSSI-bin.000002两个日志文件被删除了。</p>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用PURGE MASTER LOGS删除2019年1月30日前创建的所有日志文件，执行命令及结果如下：</p>
                <pre>
                    <code class="sql">
    mysql> PURGE MASTER LOGS BEFORE "20190130";
    Query OK, 0 rows affected (0.07 sec)
                    </code>
                </pre>
                <p class="firstLineIndent">语句执行之后，2019年1月30日之前创建的日志文件都将被删除，但2019年1月30日的日志会被保留。使用mysqlbinlog可以查看指定日志的创建时间，部分日志内容如下：</p>
                <pre>
                    <code class="sql">
    /*!40019 SET @@session.max_insert_delayed_threads=0*/;
    /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;
    DELIMITER /*!*/;
    # at 4
    #190130 15:27:48 server id 1 end_log_pos 107 Start: binlog v 4, server v 8.0.13-log created 160330
    # Warning: this binlog is either in use or was not closed properly.
    ROLLBACK/*!*/;
    BINLOG '
                    </code>
                </pre>
                <p class="firstLineIndent">其中，190130为日志创建的时间，即2019年1月30日。</p>
            </div>
            <div id="log_classification_binary_log_4" class="tab-pane fade">
                <p class="firstLineIndent">如果MySQL服务器启用了二进制日志，在数据库出现意外丢失数据时，可以使用<code>mysqlbinlog</code>工具从指定的时间点开始（例如，最后一次备份）直到现在，或另一个指定的时间点的日志中恢复数据。</p>
                <p class="firstLineIndent">要想从二进制日志恢复数据，需要知道当前二进制日志文件的路径和文件名，一般可以从配置文件（my.cnf或者my.ini，文件名取决于MySQL服务器的操作系统）中找到路径。</p>
                <p class="firstLineIndent">mysqlbinlog恢复数据的语法如下：</p>
                <p class="firstLineIndent"><code>mysqlbinlog [option] filename | mysql -uuser -ppass</code></p>
                <hr>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>参数</th>
                        <th>作用</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>[option]</td>
                        <td class="tinyHand" onclick="logClassificationBinaryLog4MysqlbinlogOptionTips()">一些可选项 <i class="fa fa-hand-pointer-o"></i></td>
                    </tr>
                    <tr>
                        <td>filename</td>
                        <td>表示日志文件名</td>
                    </tr>
                    </tbody>
                </table>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用mysqlbinlog恢复MySQL数据库到2020年12月12日 15:46:18时的状态，执行命令及结果如下：</p>
                <pre>
                    <code class="sql">
    C:\ >mysqlbinlog --stop-date="2020-12-12 15:46:18" D:\mysql\log\binlog\X0NHUMO7YDZVSST-bin.000003 | mysql -uroot -p123456
                    </code>
                </pre>
                <p class="firstLineIndent">该命令执行成功后，会根据X0NHUMO7YDZVSST-bin.000003日志文件恢复2020年12月12日 15:46:18以前的所有操作。这种方法对于意外操作非常有效，比如因操作不当误删了数据表。</p>
            </div>
            <div id="log_classification_binary_log_5" class="tab-pane fade">
                <p class="firstLineIndent">如果在MySQL的配置文件中配置启动了二进制日志，MySQL会一直记录二进制日志。修改配置文件，可以停止二进制日志，但是需要重启MySQL数据库。MySQL提供了暂时停止二进制日志的功能。通过<code>SET SQL_LOG_BIN</code>语句可以使用MySQL暂停或者启动二进制日志。</p>
                <p class="firstLineIndent">SET SQL_LOG_BIN的语法如下：</p>
                <p class="firstLineIndent"><code>SET sql_log_bin = {0 | 1};</code></p>
                <hr>
                <p class="firstLineIndent">执行如下语句将暂停记录二进制日志：</p>
                <pre>
                    <code class="sql">
    mysql> SET sql_log_bin = 0;
    Query OK, 0 rows affected (0.00 sec)
                    </code>
                </pre>
                <p class="firstLineIndent">执行如下语句将恢复记录二进制日志：</p>
                <pre>
                    <code class="sql">
    mysql> SET sql_log_bin = 1;
    Query OK, 0 rows affected (0.00 sec)
                    </code>
                </pre>
            </div>
        </div>
    </div>
</div>

<!-- 日志分类-二进制日志提示 -->
<div id="log_classification_binary_log_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">二进制日志</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            二进制日志主要记录MySQL数据库的变化。二进制日志以一种有效的格式并且是事务安全的方式包含更新日志中可用的所有信息。二进制日志包含了所有更新了数据或者已经
            潜在更新了数据（例如，没有匹配任何行的一个DELETE）的语句。语句以“事件”的形式保存，描述数据更改。
        </p>
        <p class="firstLineIndent">
            二进制日志还包含关于每个更新数据库的语句的执行时间信息。它不包含没有修改任何数据的语句。如果想要记录所有语句（例如，为了识别有问题的查询），需要使用一般
            查询日志。<b>使用二进制日志的主要目的是最大可能地<span class="note">恢复数据库</span>，因为二进制日志包含备份后进行的所有更新。</b>
        </p>
    </div>
</div>

<!-- 日志分类-二进制日志-启动和设置二进制日志-log-bin提示 -->
<div id="log_classification_binary_log_1_log_bin_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">log-bin [=path/ [filename]]</h3>
    </div>
    <div class="panel-body">
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>log-bin</td>
                <td>定义开启二进制日志</td>
            </tr>
            <tr>
                <td>path</td>
                <td>表明日志文件所在的目录路径</td>
            </tr>
            <tr>
                <td>filename</td>
                <td>指定了日志文件的名称，如文件的全名为filename.000001、filename.000002等。除了上述文件之外，还有一个名称为filename.index的文件，文件内容为所有日志的清单，可以使用记事本打开该文件</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- 日志分类-二进制日志-使用二进制日志恢复数据库-mysqlbinlog-option提示 -->
<div id="log_classification_binary_log_4_mysqlbinlog_option_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">option</h3>
    </div>
    <div class="panel-body">
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>--start-date</td>
                <td>指定恢复数据库的起始时间</td>
            </tr>
            <tr>
                <td>--stop-date</td>
                <td>指定恢复数据库的结束时间</td>
            </tr>
            <tr>
                <td>--stop-position</td>
                <td>指定恢复数据库的开始位置</td>
            </tr>
            <tr>
                <td>--stop-position</td>
                <td>指定恢复数据库的结束 位置</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- 日志分类-错误日志 -->
<div id="log_classification_error_log" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title tinyHand" onclick="logClassificationErrorLogTips()">错误日志 <i class="fa fa-hand-pointer-o"></i></h3>
    </div>
    <div class="panel-body">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#log_classification_error_log_1" data-toggle="tab">启动和设置错误日志</a></li>
            <li><a href="#log_classification_error_log_2" data-toggle="tab">查看错误日志</a></li>
            <li><a href="#log_classification_error_log_3" data-toggle="tab">删除错误日志</a></li>
        </ul>
        <div class="tab-content">
            <div id="log_classification_error_log_1" class="tab-pane fade in active">
                <p class="firstLineIndent">
                    在默认情况下，错误日志会记录到数据库的数据目录下。如果没有在配置文件中指定文件名，则文件名默认为<b>hostname.err</b>。例如，MySQL所在的服务器主机名为mysql-db，记录错误信息的文件名
                    为mysql-db.err。如果执行了<code>FLUSH LOGS</code>，错误日志文件会重新加载。
                </p>
                <p class="firstLineIndent">错误日志的启动和停止以及指定日志文件名都可以通过修改my.ini（或者my.cnf）来配置。错误日志的配置项时log-error。在[mysqld]下配置log-error，则启动错误日志。如果需要指定文件名，则配置项如下：</p>
                <pre>
                    <code class="sql">
    [mysqld]
    log-error=[path/[file_name]]
                    </code>
                </pre>
                <hr>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>参数</th>
                        <th>作用</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>path</td>
                        <td>为日志文件所在的目录路径</td>
                    </tr>
                    <tr>
                        <td>file_name</td>
                        <td>为日志文件名</td>
                    </tr>
                    </tbody>
                </table>
                <p class="firstLineIndent"><span class="note">修改配置项后，需要重启MySQL服务以生效。</span></p>
            </div>
            <div id="log_classification_error_log_2" class="tab-pane fade">
                <p class="firstLineIndent">通过错误日志可以监视系统的运行状态，便于及时发现故障、修复故障。MySQL错误日志时以文本文件形式存储的，可以使用文本编辑器直接查看MySQL错误日志。</p>
                <p class="firstLineIndent">如果不知道日志文件的存储路径，可以使用<code>SHOW VARIABLES</code>语句查询错误日志的存储路径。SHOW VARIABLES语句如下：</p>
                <p class="firstLineIndent"><code>SHOW VARIABLES LIKE 'log_error';</code></p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用记事本查看MySQL错误日志：</p>
                <pre>
                    <code class="sql">
    mysql> SHOW VARIABLES LIKE 'log_error';
    +----------------+-------------------------+
    | Variable_name  |          Value          |
    +----------------+-------------------------+
    |   log_error    |  .\X0NHUMO7YDZVSSI.err  |
    +----------------+-------------------------+




    20201212 16:50:45 [Note] Plugin 'FEDERATED' is disabled.
    20201212 16:50:45 InnoDB: The InnoDB memory heap is disabled
    20201212 16:50:45 InnoDB: Mutexes and rw_locks use Windows interlocked functions
    20201212 16:50:45 InnoDB: Compressed tables use zlib 1.2.3
    20201212 16:50:45 InnoDB: Initializing buffer pool, size = 46.0M
    20201212 16:50:45 InnoDB: Completed initialization of buffer pool
    20201212 16:50:45 InnoDB: highest supported file format is Barracuda.
    20201212 16:50:45 InnoDB: Waiting for the background threads to start
    20201212 16:50:45 InnoDB: 1.1.7 started; log sequence number 1679264
    20201212 16:50:46 [Note] Event Scheduler: Loaded 0 events
    20201212 16:50:46 [Note] C:\Program Files\MySQL\MySQL Server 8.0\bin\mysqld:ready for connections.
    Version: '8.0.13-log' socket: '' post: 3306 MySQL Community Server (GPL)
                    </code>
                </pre>
                <p class="firstLineIndent">以上是错误日志文件的一部分，这里面记载了系统的一些错误。</p>
            </div>
            <div id="log_classification_error_log_3" class="tab-pane fade">
                <p class="firstLineIndent">MySQL的错误日志是以文本文件的形式存储在文件系统中的，可以直接删除。</p>
                <p class="firstLineIndent">
                    对于MySQL 5.5.7以前的版本，<code>FLUSH LOGS</code>可以将错误日志文件重命名为filename.err_old，并创建新的日志文件。但是从MySQL 5.5.7开始，<code>FLUSH LOGS</code>只是
                    重新打开日志文件，并不做日志备份和创建的操作。如果日志文件不存在，MySQL启动或者执行<code>FLUSH LOGS</code>时会创建新的日志文件。
                </p>
                <p class="firstLineIndent">
                    在运行状态下删除错误日志文件后，MySQL并不会自动创建日志文件。<code>FLUSH LOGS</code>在重新加载日志的时候，如果文件不存在，则会自动创建。所以在删除错误日志之后，如果需要重建日志文件，
                    需要在服务器端执行以下命令：
                </p>
                <p class="firstLineIndent"><code>mysqladmin -u root -p flush-logs</code></p>
                <p class="firstLineIndent">或者在客户段登录MySQL数据库，执行<code>FLUSH LOGS</code>语句：</p>
                <pre>
                    <code class="sql">
    mysql> FLUSH LOGS;
    Query OK, 0 rows affected (0.23 sec)
                    </code>
                </pre>
            </div>
        </div>
    </div>
</div>

<!-- 日志分类-错误日志提示 -->
<div id="log_classification_error_log_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">错误日志</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">错误日志文件包含了当mysqld启动和停止时，以及服务器在运行过程中发生任何严重错误时的相关信息。在MySQL中，错误日志也是非常有用的，MySQL会将启动和停止数据库信息以及一些错误信息记录到错误日志文件中。</p>
    </div>
</div>

<!-- 日志分类-通用查询日志 -->
<div id="log_classification_general_query_log" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title tinyHand" onclick="logClassificationGeneralQueryLogTips()">通用查询日志 <i class="fa fa-hand-pointer-o"></i></h3>
    </div>
    <div class="panel-body">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#log_classification_general_query_log_1" data-toggle="tab">启动通用查询日志</a></li>
            <li><a href="#log_classification_general_query_log_2" data-toggle="tab">查看通用查询日志</a></li>
            <li><a href="#log_classification_general_query_log_3" data-toggle="tab">删除通用查询日志</a></li>
        </ul>
        <div class="tab-content">
            <div id="log_classification_general_query_log_1" class="tab-pane fade in active">
                <p class="firstLineIndent">MySQL服务器默认情况下并没有开启通用查询日志。通过<code>SHOW VARIABLES LIKE '%general%';</code>语句可以查询当前查询日志的状态：</p>
                <pre>
                    <code class="sql">
    mysql> SHOW VARIABLES LIKE '%general%';
    +------------------+---------------------+
    | Variable_name    |      Value          |
    +------------------+---------------------+
    | general_log      | OFF                 |
    | general_log_file | X0NHUMO7YDZVSSI.log |
    +------------------+---------------------+
    2 rows in set, 1 warning (0.11 sec)
                    </code>
                </pre>
                <p class="firstLineIndent">从结果可以看出，通用查询日志的状态为OFF，表示通用日志是关闭的。</p>
                <p class="firstLineIndent">开启通用日志的方法如下：</p>
                <pre>
                    <code class="sql">
    mysql> SET @@global.general_log = 1;
    Query OK, 0 rows affected (0.04 sec)
                    </code>
                </pre>
                <p class="firstLineIndent">再次查询通用日志的状态：</p>
                <pre>
                    <code class="sql">
    mysql> SHOW VARIABLES LIKE '%general%';
    +------------------+---------------------+
    | Variable_name    |      Value          |
    +------------------+---------------------+
    | general_log      | ON                  |
    | general_log_file | X0NHUMO7YDZVSSI.log |
    +------------------+---------------------+
    2 rows in set, 1 warning (0.03 sec)
                    </code>
                </pre>
                <p class="firstLineIndent">从结果可以看出，通用查询日志的状态为ON，表示通用日志已经开启了。</p>
                <p class="firstLineIndent">如果想关闭通用日志，执行以下语句即可：</p>
                <pre>
                    <code class="sql">
    mysql> SET @@global.general_log = 0;
    Query OK, 0 rows affected (0.00 sec)
                    </code>
                </pre>
            </div>
            <div id="log_classification_general_query_log_2" class="tab-pane fade">
                <p class="firstLineIndent">
                    通用查询日志中记录了用户的所有操作。通过查看通用查询日志，可以了解用户对MySQL进行的操作。通用查询日志是以文本文件的形式存储在文件系统中的，可以使用文本编辑器直接打开通用日志文件
                    进行查看，Windows下可以使用记事本，Linux下可以使用vim、gedit等。
                </p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用记事本查看MySQL通用查询日志：</p>
                <pre>
                    <code class="sql">
    C:\Program Files\MySQL\MySQL Server 8.0\bin\mysqld.exe,Version: 8.0.13 (MySQL Community Server - GPL). started with:
    TCP Port: 3306, Named Pipe: MySQL
    Time                  Id  Command    Argument
    2020-12-12 17:58:01   1   Connect    root@localhost on 1 Query select @@version_comment limit 1
    2020-12-12 17:59:03   1   Query      SELECT DATABASE() 1 Init DB test
    2020-12-12 17:59:25   1   Query      SELECT * FROM fruits
    2020-12-12 18:01:22   1   Quit
                    </code>
                </pre>
                <p class="firstLineIndent">以上是通用查询日志文件的一部分，可以看到MySQL启动信息和用户root连接服务器与执行查询语句的记录。</p>
            </div>
            <div id="log_classification_general_query_log_3" class="tab-pane fade">
                <p class="firstLineIndent">通用查询日志是以文本文件的形式存储在文件系统中的。通用查询日志记录用户的所有操作，因此在用户查询、更新频繁的情况下，通用查询日志会增长的很快。数据库管理员可以定期删除比较早的通用日志，以节省磁盘空间。</p>
                <p class="firstLineIndent">可以用直接删除日志文件的方式删除通用查询日志。要重新建立新的日志文件，可使用语句<code>mysqladmin -u root -p flush-logs</code></p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">在数据目录中找到日志文件所在目录C:\ProgramData\MySQL\MySQL Server 8.0\Data\，删除该后缀为.log的文件。</p>
                <p class="firstLineIndent">通过<code>mysqladmin -u root -p flush-logs</code>命令建立新的日志文件，执行命令如下：</p>
                <pre>
                    <code class="sql">
    C:\ > mysqladmin -u root -p flush-logs
                    </code>
                </pre>
                <p class="firstLineIndent">执行完该命令，可以看到C:\ProgramData\MySQL\MySQL Server 8.0\Data\目录中已经建立了新的日志文件。</p>
            </div>
        </div>
    </div>
</div>

<!-- 日志分类-日志分类-通用查询日志提示 -->
<div id="log_classification_general_query_log_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">通用查询日志</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">通用查询日志记录MySQL的所有用户操作，包括启动和关闭服务、执行查询和更新语句等。</p>
    </div>
</div>

<!-- 日志分类-慢查询日志 -->
<div id="log_classification_slow_query_log" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title tinyHand" onclick="logClassificationSlowQueryLogTips()">慢查询日志 <i class="fa fa-hand-pointer-o"></i></h3>
    </div>
    <div class="panel-body">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#log_classification_slow_query_log_1" data-toggle="tab">启动和设置慢查询日志</a></li>
            <li><a href="#log_classification_slow_query_log_2" data-toggle="tab">查看慢查询日志</a></li>
            <li><a href="#log_classification_slow_query_log_3" data-toggle="tab">删除慢查询日志</a></li>
        </ul>
        <div class="tab-content">
            <div id="log_classification_slow_query_log_1" class="tab-pane fade in active">
                <p class="firstLineIndent">
                    MySQL中慢查询日志默认是关闭的，可以通过配置文件my.ini或者my.cnf中的<code>log-slow-queries</code>选项打开，也可以在MySQL服务启动的时候使用<code>--log-slow-queries[=file_name]</code>
                    启动慢查询日志。启动慢查询日志时，需要在my.ini或者my.cnf文件中配置<code>long_query_time</code>选项指定记录阈值，如果某条件查询语句的查询时间超过了这个值，这个查询过程将被记录到慢查询日志文件中。
                </p>
                <p class="firstLineIndent">在my.ini或者my.cnf开启慢查询日志的配置如下：</p>
                <pre>
                    <code class="sql">
    [mysqld]
    log-slow-queries [= path/[filename]]
    long_query_time = n
                    </code>
                </pre>
                <hr>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>参数</th>
                        <th>作用</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>path</td>
                        <td>为日志文件所在目录路径</td>
                    </tr>
                    <tr>
                        <td>filename</td>
                        <td>为日志文件名</td>
                    </tr>
                    </tbody>
                </table>
                <p class="firstLineIndent">如果不指定目录和文件名称，默认存储在数据目录中，文件为hostname-slow.log。</p>
                <hr>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>参数</th>
                        <th>作用</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>hostname</td>
                        <td>是MySQL服务器的主机名</td>
                    </tr>
                    <tr>
                        <td>n</td>
                        <td>是时间值，单位是秒。如果没有设置long_query_time选项，默认时间为10秒</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div id="log_classification_slow_query_log_2" class="tab-pane fade">
                <p class="firstLineIndent">
                    MySQL的慢查询日志是以文本形式存储的，可以直接使用文本编辑器查看。在慢查询日志中，记录着执行时间较长的查询语句，用户可以从慢查询日志中获取执行效率较低的查询语句，为查询优化提供重要的依据。
                </p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">查看慢查询日志。使用文本编辑器打开数据目录下的Kevin-slow.log文件，文件部分如下：</p>
                <pre>
                    <code class="sql">
    C:\Program Files\MySQL\MySQL Server 8.0\bin\mysqld.exe,Version: 8.0.13 (MySQL Community Server - GPL). started with:
    TCP Port: 3306, Named Pipe: MySQL
    Time                  Id  Command    Argument
    # Time: 20201212 18:25:33
    # User@Host: root[root] @ localhost [127.0.0.1]
    # Query_time: 136.500000 Lock_time: 0.000000 Rows_sent: 1 Rows_examined: 0
    SET timestamp = 1607768733;
    SELECT BENCHMARK(100000000, PASSWORD('newpwd'));
                    </code>
                </pre>
                <p class="firstLineIndent">
                    可以看到，这里记录了一条慢查询日志。执行该条查询语句的账户是root@localhost，查询时间是136.500000秒，查询语句是
                    SELECT BENCHMARK(100000000, PASSWORD('newpwd'));，该语句的查询时间大大超过了默认值10秒钟，因此被记录在慢查询日志文件中。
                </p>
                <p class="firstLineIndent">
                    <span class="note">注意</span>：借助慢查询日志分析工具，可以更加方便地分析慢查询语句。比较著名的慢查询工具有MySQL Dump Slow、MySQL SLA、MySQL Log Filter、MyProfi。
                </p>
            </div>
            <div id="log_classification_slow_query_log_3" class="tab-pane fade">
                <p class="firstLineIndent">
                    和通用查询日志一样，慢查询日志也可以直接删除。删除后在不重启服务器的情况下，需要执行<code>mysqladmin -u root -p flush-logs</code>重新生成日志文件，
                    或者在客户端登录到服务器执行<code>FLUSH LOGS</code>语句重建日志文件。
                </p>
            </div>
        </div>
    </div>
</div>

<!-- 日志分类-慢查询日志提示 -->
<div id="log_classification_slow_query_log_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">慢查询日志</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">慢查询日志是记录查询时长超过指定时间的日志。通过慢查询日志，可以找出执行时间较长、执行效率较低的语句，然后进行优化。</p>
    </div>
</div>

<!-- 日志分类更详细提示 -->
<div id="log_classification_is_more_detailed_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">日志分类更详细</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">在MySQL 8.0版本中，日志分类将更加详细。例如，在错误日志中添加了错误信息编号[MY-010311]和错误所属子系统[Server]。</p>
        <p class="firstLineIndent">在MySQL 5.7版本中，部分错误日志如下：</p>
        <pre>
            <code class="sql">
    2020-12-12T19:58:32.114585+08:00    0   [Warning]   'proxies_priv'  entry   '@ root@localhost'               ignored in --skip-name-resolve mode.
    2020-12-12T19:58:32.117848+08:00    0   [Warning]   'tables_priv'   entry   'user mysql.session@localhost'   ignored in --skip-name-resolve mode.
    2020-12-12T19:58:32.117868+08:00    0   [Warning]   'tables_priv'   entry   'sys_config mysql.sys@localhost' ignored in --skip-name-resolve mode.
            </code>
        </pre>
        <p class="firstLineIndent">在MySQL 8.0版本中，部分错误日志如下：</p>
        <pre>
            <code class="sql">
    2020-12-12T20:02:56.040295+08:00    0   [Warning]   [MY-010311]  [Server]   'proxies_priv'  entry   '@ root@localhost'               ignored in --skip-name-resolve mode.
    2020-12-12T20:02:56.040520+08:00    0   [Warning]   [MY-010311]  [Server]   'tables_priv'   entry   'user mysql.session@localhost'   ignored in --skip-name-resolve mode.
    2020-12-12T20:02:56.040542+08:00    0   [Warning]   [MY-010311]  [Server]   'tables_priv'   entry   'sys_config mysql.sys@localhost' ignored in --skip-name-resolve mode.
            </code>
        </pre>
    </div>
</div>

<!-- 分析查询语句提示 -->
<div id="analyze_query_statements_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">分析查询语句</h3>
    </div>
    <div class="panel-body">
        <p class="fa fa-fire"> EXPLAIN</p>
        <p class="firstLineIndent">通过对查询语句的分析，可以了解查询语句执行情况，找出查询语句执行的瓶颈，从而优化查询语句。MySQL中提供了<code>EXPLAIN</code>语句和<code>DESCRIBE</code>语句，用来分析查询语句。</p>
        <p class="firstLineIndent">EXPLAIN语句的基本语法如下：</p>
        <p class="firstLineIndent"><code>EXPLAIN [EXTENDED] SELECT select_options;</code></p>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>[EXTENDED]</td>
                <td>使用该关键字，EXPLAIN语句将产生附加信息</td>
            </tr>
            <tr>
                <td>select_options</td>
                <td>是SELECT语句的查询选项，包括FROM WHERE子句等</td>
            </tr>
            </tbody>
        </table>
        <p class="firstLineIndent">执行<code>EXPLAIN</code>语句，可以分析后面<code>SELECT</code>语句的执行情况，并且能够分析出所查询表的的一些特征。</p>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">使用EXPLAIN语句来分析一个查询语句，可执行如下语句：</p>
        <pre>
            <code class="sql">
    mysql> EXPLAIN SELECT * FROM fruits;
    +----+-------------+--------+------+---------------+------+---------+------+------+-------+
    | id | select_type | table  | type | possible_keys | key  | key_len | ref  | rows | Extra |
    +----+-------------+--------+------+---------------+------+---------+------+------+-------+
    | 1  |   SIMPLE    | fruits | ALL  |      NULL     | NULL |   NULL  | NULL |  16  |       |
    +----+-------------+--------+------+---------------+------+---------+------+------+-------+
    1 row in set (0.00 sec)
            </code>
        </pre>
        <hr>
        <p class="fa fa-fire"> DESCRIBE</p>
        <p class="firstLineIndent"><code>DESCRIBE</code>语句的使用方法与<code>EXPLAIN</code>语句是一样的，并且分析结果也是一样的。DESCRIBE语句的语法形式如下：</p>
        <p class="firstLineIndent"><code>DESCRIBE SELECT select_options;</code></p>
        <p class="firstLineIndent">DESCRIBE可以缩写成DESC</p>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-id -->
<div id="analyze_query_statements_explain_id" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">id</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">id代表SELECT标识符。这是SELECT的查询序列号。</p>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-select_type -->
<div id="analyze_query_statements_explain_select_type" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">select_type</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">select_type表示SELECT语句的类型，它可以是以下几种取值：</p>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>SIMPLE</td>
                <td>表示简单查询，其中不包括连接查询和子查询</td>
            </tr>
            <tr>
                <td>PRIMARY</td>
                <td>表示主查询，或者是最外层的查询语句</td>
            </tr>
            <tr>
                <td>UNION</td>
                <td>表示连接查询的第2个或后面的查询语句</td>
            </tr>
            <tr>
                <td>DEPENDENT UNION</td>
                <td>连接查询中的第2个或后面的SELECT语句，取决于外面的查询</td>
            </tr>
            <tr>
                <td>UNION RESULT</td>
                <td>连接查询的结果</td>
            </tr>
            <tr>
                <td>SUBQUERY</td>
                <td>子查询中的第1个SELECT语句</td>
            </tr>
            <tr>
                <td>DEPENDENT SUBQUERY</td>
                <td>子查询中的第1个SELECT，取决于外面的查询</td>
            </tr>
            <tr>
                <td>DERIVED</td>
                <td>导出表的SELECT（FROM子句的子查询）</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-table -->
<div id="analyze_query_statements_explain_table" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">table</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">table表示查询的表。</p>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-type -->
<div id="analyze_query_statements_explain_type" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">type</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">type表示表的连接类型，下面按照从最佳类型到最差类型的顺序给出各种连接类型：</p>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>system</td>
                <td>该表是仅有一行的系统表。这是<code>const</code>连接类型的一个特例</td>
            </tr>
            <tr>
                <td>const</td>
                <td class="tinyHand" onclick="analyzeQueryStatementsExplainTypeConstTips()">数据表最多只有一个匹配行，将在查询开始时被读取，并在余下的查询优化中作为常量对待。const表查询速度很快，因为它们只读取一次。const用于使用常数值比较<code>PRIMARY KEY</code>或<code>UNIQUE</code>索引的所有部分的场合 <i class="fa fa-hand-pointer-o"></i></td>
            </tr>
            <tr>
                <td>eq_ref</td>
                <td class="tinyHand" onclick="analyzeQueryStatementsExplainTypeEqrefTips()">
                    对于每个来自前面的表的行组合，从该表中读取一行。当一个索引的所有部分都在查询中使用并且索引是<code>UNIQUE</code>或<code>PRIMARY KEY</code>时，即可使用这种类型。eq_ref可以用于
                    使用“=”操作符比较带索引的列。比较值可以为常量或一个在该表前面所读取的表的列的表达式
                    <i class="fa fa-hand-pointer-o"></i>
                </td>
            </tr>
            <tr>
                <td class="tinyHand" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">ref</td>
                <td class="tinyHand" onclick="analyzeQueryStatementsExplainTypeRefTips()">
                    对于来自前面的表的任意行组合，将从该表中读取所有匹配的行。这种类型用于索引既不是<code>UNIQUE</code>也不是<code>PRIMARY KEY</code>的情况，或者查询中使用了索引列的左子集，即索引
                    中左边的部分列组合。ref可以用于使用“=”或“&lt;=&gt;”操作符带索引的列
                    <i class="fa fa-hand-pointer-o"></i>
                    <p id="collapseOne" class="panel-collapse collapse">aaaaa</p>
                </td>
            </tr>
            <tr>
                <td>ref_or_null</td>
                <td class="tinyHand" onclick="analyzeQueryStatementsExplainTypeRefOrNUllTips()">该连接类型如同ref，但是添加了MySQL可以专门搜索包含NULL值的行。在解决子查询中经常使用该连接类型的优化 <i class="fa fa-hand-pointer-o"></i></td>
            </tr>
            <tr>
                <td>index_merge</td>
                <td>该连接类型表示使用了索引合并优化方法。在这种情况下，key列包含了使用的索引的清单，key_len包含了使用索引的最长关键元素</td>
            </tr>
            <tr>
                <td>unique_subquery</td>
                <td>
                    它是一个索引查找函数，可以完全替换子查询，效率更高。该类型替换了下面形式的IN子查询的ref：<br/>
                    value IN (SELECT primary_key FROM single_table WHERE some_expr)
                </td>
            </tr>
            <tr>
                <td>index_subquery</td>
                <td>
                    该连接类型类似于unique_subquery，可以替换IN子查询，但只适合下列形式的子查询中的非唯一索引：<br/>
                    value IN (SELECT key_column FROM single_table WHERE some_expr)
                </td>
            </tr>
            <tr>
                <td>range</td>
                <td class="tinyHand" onclick="analyzeQueryStatementsExplainTypeRangeTips()">
                    只检索给定范围的行，使用一个索引来选择行。key列显示使用了哪个索引。key_len包含所有使用索引的最长关键元素。
                    当使用“=”、“&lt;&gt;”、“&gt;”、“&gt;=”、“&lt;”、“&lt;=”、“IS NULL”、“&lt;=&gt;”、“BETWEEN”或者“IN”操作符用常量比较关键字列时，类型为range
                    <i class="fa fa-hand-pointer-o"></i>
                </td>
            </tr>
            <tr>
                <td>index</td>
                <td>该连接类型与ALL相同，除了只扫描索引树。这通常比ALL快，因为索引文件通常比数据文件小</td>
            </tr>
            <tr>
                <td>All</td>
                <td>对于前面的表的任意行组合，进行完整的表扫描。如果表是第一个没标记const的表，这样不好，并且在其他情况下很差。通常可以增加更多的索引来避免使用All连接</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-type-const提示 -->
<div id="analyze_query_statements_explain_type_const_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">const</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">在下面的查询中，tb1_name可用于const表：</p>
        <pre>
            <code class="sql">
    SELECT * FROM tb1_name
    WHERE primary_key = 1;

    SELECT * FROM tb1_name
    WHERE primary_key_part1 = 1
    AND primary_key_part2 = 2;
            </code>
        </pre>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-type-eq_ref提示 -->
<div id="analyze_query_statements_explain_type_eq_ref_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">eq_ref</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">在下面的例子中，MySQL可以使用eq_ref连接来处理ref_tables：</p>
        <pre>
            <code class="sql">
    SELECT * FROM ref_table,other_table
    WHERE ref_table.key_column = other_table.column;

    SELECT * FROM ref_table,other_table
    WHERE ref_table.key_column = other_table.column
    AND ref_table.key_column_part2 = 1;
            </code>
        </pre>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-type-ref提示 -->
<div id="analyze_query_statements_explain_type_ref_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">ref</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">在下面的例子中，MySQL可以使用ref连接来处理ref_tables：</p>
        <pre>
            <code class="sql">
    SELECT * FROM ref_table WHERE key_column = expr;

    SELECT * FROM ref_table,other_table
    WHERE ref_table.key_column = other_table.column;

    SELECT * FROM ref_table,other_table
    WHERE ref_table.key_column_part1 = other_table.column
    AND ref_table.key_column_part2 = 1;
            </code>
        </pre>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-type-ref_or_null提示 -->
<div id="analyze_query_statements_explain_type_ref_or_null_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">ref_or_null</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">在下面的例子中，MySQL可以使用ref_or_null连接来处理ref_tables：</p>
        <pre>
            <code class="sql">
    SELECT * FROM ref_table
    WHERE key_column = expr OR key_column IS NULL;
            </code>
        </pre>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-type-range提示 -->
<div id="analyze_query_statements_explain_type_range_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">range</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">下面介绍几种检索指定行情况：</p>
        <pre>
            <code class="sql">
    SELECT * FROM tb1_name
    WHERE key_column = 10;

    SELECT * FROM tb1_name
    WHERE key_column BETWEEN 10 AND 20;

    SELECT * FROM tb1_name
    WHERE key_column IN (10,20,30);

    SELECT * FROM tb1_name
    WHERE key_part1 = 10 AND key_part2 IN (10,20,30);
            </code>
        </pre>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-possible_keys -->
<div id="analyze_query_statements_explain_possible_keys" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">possible_keys</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            指出MySQL能使用哪个索引在该表中找到行。如果该列是<span class="note">NULL</span>，则没有相关的索引。在这种情况下，可以通过检查WHERE子句看它是否引用某些列或适合索引的列来提高查询性能。
            如果是这样，可以创建适合的索引来提高查询的性能
        </p>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-key -->
<div id="analyze_query_statements_explain_key" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">key</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            表示查询实际使用到的索引，如果没有选择索引，该列的值是<span class="note">NULL</span>。要想强制MySQL使用或忽视<code>possible_keys</code>列中的索引，在查询中使用
            <code>FORCE INDEX</code>、<code>USE INDEX</code>或者<code>IGNORE INDEX</code>。参见SELECT语法。
        </p>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-key_len -->
<div id="analyze_query_statements_explain_key_len" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">key_len</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            表示MySQL选择的索引字段按字节计算的长度，如果键是<span class="note">NULL</span>，则长度为NULL。注意，通过key_len值可以确定MySQL将实际使用一个多列索引中的几个字段
        </p>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-ref -->
<div id="analyze_query_statements_explain_ref" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">ref</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            表示使用哪个列或常数与索引一起来查询记录
        </p>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-rows -->
<div id="analyze_query_statements_explain_rows" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">rows</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            显示MySQL在表中进行查询时必须检查的行数
        </p>
    </div>
</div>

<!-- 分析查询语句-EXPLAIN-Extra -->
<div id="analyze_query_statements_explain_extra" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">Extra</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            表示MySQL在处理查询时的详细信息
        </p>
    </div>
</div>

<!-- 优化子查询提示 -->
<div id="optimize_subqueries_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">优化子查询</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            MySQL从4.1版本开始支持子查询，使用子查询可以进行SELECT语句的嵌套查询，即<b>一个SELECT查询的结果作为另一个SELECT语句的条件。</b>子查询可以一次性完成很多逻辑上
            需要多个步骤才能完成的SQL操作。子查询虽然可以使查询语句很灵活，但执行效率不高。执行子查询时，MySQL需要为内层查询语句的查询结果建立一个临时表。然后外层查询语句从临时
            表中查询记录。查询完毕后，再撤销这些临时表。因此，子查询的速度会受到一定的影响。如果查询的数据量比较大，这种影响就会随之增大。
        </p>
        <p class="firstLineIndent">
            在MySQL中，可以使用连接（<code>JOIN</code>）查询来替代子查询。连接查询不需要建立临时表，其速度比子查询要快，如果查询中使用索引，性能会更好。连接之所以更有效，是
            因为MySQL不需要在内存中创建临时表来完成查询工作。
        </p>
    </div>
</div>

<!-- 优化数据库结构提示 -->
<div id="optimize_database_structure_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">优化数据库结构</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            一个好的数据库设计方案对于数据库的性能常常会起到事半功倍的效果。合理的数据库结构不仅可以使数据库占用更小的磁盘空间，而且能够使查询速度更快。数据库结构的设计，需要考虑数据冗余、查询和更新的速度、
            字段的数据类型是否合理等多方面的内容。
        </p>
    </div>
</div>

<!-- 优化数据库结构-将字段很多的表分解成多个表 -->
<div id="optimize_database_structure_break_a_table_with_many_fields_into_multiple_tables" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">将字段很多的表分解成多个表</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">对于字段较多的表，如果有些字段的使用频率很低，可以将这些字段分离出来，形成新表。因为当一个表的数据量很大时，会由于使用频率低的字段的存在而变慢。</p>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">
            假设会员表存储会员登录认证信息，该表中有很多字段，如id、姓名、密码、地址、电话、个人描述字段。其中，地址、电话、个人描述等字段并不常用。可以将这些不常用字段分解出另外一个表。
            将这个表取名叫members_detail。表中有member_id、address、telephone、description等字段。其中，member_id是会员编号，address字段存储地址信息，telephone字段存储
            电话信息，description字段存储会员个人描述信息。这样就把会员表分成两个表，分别为members表和members_detail表。
        </p>
        <p class="firstLineIndent">创建这两个表的SQL语句如下：</p>
        <pre>
            <code class="sql">
    mysql> CREATE TABLE members (
        -> id int(11) NOT NULL AUTO_INCREMENT,
        -> username varchar(255) DEFAULT NULL,
        -> password varchar(255) DEFAULT NULL,
        -> last_login_time datetime DEFAULT NULL,
        -> last_login_ip varchar(255) DEFAULT NULL,
        -> PRIMARY KEY(id)
        -> );
    mysql> CREATE TABLE members_detail (
        -> member_id int(11) NOT NULL DEFAULT 0,
        -> address varchar(255) DEFAULT NULL,
        -> telephone varchar(16) DEFAULT NULL,
        -> description text
        -> );
            </code>
        </pre>
        <p class="firstLineIndent">这两个表的结构如下：</p>
        <pre>
            <code class="sql">
    mysql> DESC members;
    +-----------------+--------------+------+-----+---------+----------------+
    |      Field      |     Type     | Null | Key | Default |      Extra     |
    +-----------------+--------------+------+-----+---------+----------------+
    |       id        | int(11)      | NO   | PRI | NULL    | auto_increment |
    |    username     | varchar(255) | YES  |     | NULL    |                |
    |    password     | varchar(255) | YES  |     | NULL    |                |
    | last_login_time | datetime     | YES  |     | NULL    |                |
    | last_login_ip   | varchar(255) | YES  |     | NULL    |                |
    +-----------------+--------------+------+-----+---------+----------------+
    5 rows in set (0.00 sec)
    mysql>
    mysql>
    mysql> DESC members_detail;
    +-------------+--------------+------+-----+---------+-------+
    |   Field     |     Type     | Null | Key | Default | Extra |
    +-------------+--------------+------+-----+---------+-------+
    | member_id   | int(11)      | NO   |     | 0       |       |
    | address     | varchar(255) | YES  |     | NULL    |       |
    | telephone   | varchar(16)  | YES  |     | NULL    |       |
    | description | text         | YES  |     | NULL    |       |
    +-------------+--------------+------+-----+---------+--------+
    4 rows in set (0.00 sec)
            </code>
        </pre>
        <p class="firstLineIndent">如果需要查询会员的详细信息，可以用会员的id来查询。如果需要将会员的基本信息和详细信息同时显示，可以将members表和members_detail表进行联合查询，查询语句如下：</p>
        <pre>
            <code class="sql">
    mysql> SELECT * FROM members
        -> LEFT JOIN members_detail
        -> ON members.id = members_detail.member_id;
            </code>
        </pre>
        <p class="firstLineIndent">通过这种分解，可以提高表的查询效率。对于字段很多且有些字段使用不频繁的表，可以通过这种分解的方式来优化数据库的性能。</p>
    </div>
</div>

<!-- 优化数据库结构-增加中间表 -->
<div id="optimize_database_structure_add_intermediate_table" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">增加中间表</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">对于需要经常联合查询的表，可以建立中间表，以提高查询效率。通过建立中间表，把需要经常联合查询的数据插入到中间表中，然后将原来的联合查询改为对中间表的查询，以此来提高查询效率。</p>
        <p class="firstLineIndent">首先，分析经常联合查询表中的字段。然后，使用这些字段建立一个中间表，并将原来联合查询的表的数据插入到中间表中。最后，使用中间表进行查询。</p>
        <hr>
        <h4><i class="fa fa-female"></i><b>示例：</b></h4>
        <p class="firstLineIndent">会员信息表和会员组信息表的SQL语句如下：</p>
        <p class="firstLineIndent">创建这两个表的SQL语句如下：</p>
        <pre>
            <code class="sql">
    mysql> CREATE TABLE vip (
        -> id int(11) NOT NULL AUTO_INCREMENT,
        -> username varchar(255) DEFAULT NULL,
        -> password varchar(255) DEFAULT NULL,
        -> groupId int(11) DEFAULT 0,
        -> PRIMARY KEY(id)
        -> );
    mysql> CREATE TABLE vip_group (
        -> id int(11) NOT NULL AUTO_INCREMENT,
        -> name varchar(255) DEFAULT NULL,
        -> remark varchar(255) DEFAULT NULL,
        -> PRIMARY KEY(id)
        -> );
            </code>
        </pre>
        <p class="firstLineIndent">查询会员信息表和会员组信息表：</p>
        <pre>
            <code class="sql">
    mysql> DESC vip;
    +----------+--------------+------+-----+---------+----------------+
    |  Field   |     Type     | Null | Key | Default |      Extra     |
    +----------+--------------+------+-----+---------+----------------+
    |   id     | int(11)      | NO   | PRI | NULL    | auto_increment |
    | username | varchar(255) | YES  |     | NULL    |                |
    | password | varchar(255) | YES  |     | NULL    |                |
    | groupId  | int(11)      | YES  |     | 0       |                |
    +----------+--------------+------+-----+---------+----------------+
    4 rows in set (0.00 sec)
    mysql>
    mysql>
    mysql> DESC vip_group;
    +--------+--------------+------+-----+---------+----------------+
    | Field  |     Type     | Null | Key | Default |     Extra      |
    +--------+--------------+------+-----+---------+----------------+
    | id     | int(11)      | NO   | PRI | NULL    | auto_increment |
    | name   | varchar(255) | YES  |     | NULL    |                |
    | remark | varchar(255) | YES  |     | NULL    |                |
    +--------+--------------+------+-----+---------+----------------+
    3 rows in set (0.00 sec)
            </code>
        </pre>
        <p class="firstLineIndent">
            已知现在有一个模块需要经常查询带有会员组名称、会员组备注（remark）、会员用户名信息的会员信息。根据这种情况可以创建一个temp_vip表。temp_vip表中存储
            用户名（user_name）、会员组名称（group_name）和会员组备注（group_remark）信息。创建表的语句如下：
        </p>
        <pre>
            <code class="sql">
    mysql> CREATE TABLE temp_vip (
        -> id int(11) NOT NULL AUTO_INCREMENT,
        -> user_name varchar(255) DEFAULT NULL,
        -> group_name varchar(255) DEFAULT NULL,
        -> group_remark varchar(255) DEFAULT NULL,
        -> PRIMARY KEY(id)
        -> );
            </code>
        </pre>
        <p class="firstLineIndent">接下来，从会员信息表和会员组表中查询相关信息存储到临时表中</p>
        <pre>
            <code class="sql">
    mysql> INSERT INTO temp_vip(user_name,group_name,group_remark)
        -> SELECT v.username,g.name,g.remark
        -> FROM vip AS v,vip_group AS g
        -> WHERE v.groupId = g.id;
    Query OK, 0 rows affected (0.95 sec)
    Records: 0 Duplicates: 0 Warnings: 0
            </code>
        </pre>
        <p class="firstLineIndent">以后，可以直接从temp_vip表中查询会员名、会员组名称和会员组备注，而不用每次都进行联合查询。这样可以提高数据库的查询速度。</p>
    </div>
</div>

<!-- 优化数据库结构-增加冗余字段 -->
<div id="optimize_database_structure_add_redundant_fields" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">增加冗余字段</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">设计数据库表时应尽量遵循范式理论的规约，尽可能减少冗余字段，让数据库设计看起来精致、优雅。但是，合理地加入冗余字段可以提高查询速度。</p>
        <p class="firstLineIndent">
            表的规范化程度越高，表与表之间的关系就越多，需要连接查询的情况也就越多。例如，员工的信息存储在staff表中，部门信息存储在department表中。通过staff表
            中的department_id字段与department表建立关联关系。如果要查询一个员工所在部门的名称，必须从staff表中查找员工所在部门的编号（department_id），然后根据
            这个编号去department表查找部门的名称。如果经常需要进行这个操作，连接查询会浪费很多时间。可以在staff表中增加一个冗余字段department_name，该字段用来存
            储员工所在部门的名称，这样就不用每次都进行连接操作了。
        </p>
        <p class="firstLineIndent">
            <span class="note">注意</span>：冗余字段会导致一些问题。比如，冗余字段的值在一个表中被修改了，就要想办法在其他表中更新该字段，否则就会使原本一致的数据
            变得不一致。分解表、增加中间表和增加冗余字段都浪费了一定的磁盘空间。从数据库性能来看，为了提高查询速度而增加少量的冗余大部分时候是可以接受的。是否通过增
            加冗余来提高数据库性能，这要根据实际需求综合分析。
        </p>
    </div>
</div>

<!-- 优化数据库结构-优化插入记录的速度 -->
<div id="optimize_database_structure_optimize_the_speed_of_inserting_records" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title tinyHand" onclick="optimizeDatabaseStructureOptimizeTheSpeedOfInsertingRecordsTips()">优化插入记录的速度 <i class="fa fa-hand-pointer-o"></i></h3>
    </div>
    <div class="panel-body">
        <ul class="nav nav-tabs">
            <li class="dropdown">
                <a href="#" id="optimize_database_structure_optimize_the_speed_of_inserting_records_1" class="dropdown-toggle" data-toggle="dropdown">对于MyISAM引擎的表<b class="caret"></b></a>
                <ul class="dropdown-menu" role="menu" aria-labelledby="optimize_database_structure_optimize_the_speed_of_inserting_records_1">
                    <li><a href="#optimize_database_structure_optimize_the_speed_of_inserting_records_1_1" tabindex="-1" data-toggle="tab">禁用索引</a></li>
                    <li><a href="#optimize_database_structure_optimize_the_speed_of_inserting_records_1_2" tabindex="-1" data-toggle="tab">禁用唯一性检查</a></li>
                    <li><a href="#optimize_database_structure_optimize_the_speed_of_inserting_records_1_3" tabindex="-1" data-toggle="tab">使用批量插入</a></li>
                    <li><a href="#optimize_database_structure_optimize_the_speed_of_inserting_records_1_4" tabindex="-1" data-toggle="tab">使用LOAD DATA INFILE批量导入</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a href="#" id="optimize_database_structure_optimize_the_speed_of_inserting_records_2" class="dropdown-toggle" data-toggle="dropdown">对于InnoDB引擎的表<b class="caret"></b></a>
                <ul class="dropdown-menu" role="menu" aria-labelledby="optimize_database_structure_optimize_the_speed_of_inserting_records_2">
                    <li><a href="#optimize_database_structure_optimize_the_speed_of_inserting_records_2_1" tabindex="-1" data-toggle="tab">禁用唯一性检查</a></li>
                    <li><a href="#optimize_database_structure_optimize_the_speed_of_inserting_records_2_2" tabindex="-1" data-toggle="tab">禁用外键检查</a></li>
                    <li><a href="#optimize_database_structure_optimize_the_speed_of_inserting_records_2_3" tabindex="-1" data-toggle="tab">禁止自动提交</a></li>
                </ul>
            </li>
        </ul>
        <div class="tab-content">
            <div id="optimize_database_structure_optimize_the_speed_of_inserting_records_1_1" class="tab-pane fade in active">
                <p class="fa fa-fire"> 禁用索引</p>
                <p class="firstLineIndent">
                    对于非空表，插入记录时，MySQL会根据表的索引对插入的记录建立索引。如果插入大量数据，建立索引会降低插入记录的速度。为了解决这种情况，可以在插入记录之前
                    禁用索引，数据插入完毕后再开启索引。禁用索引的语句如下：
                </p>
                <p class="firstLineIndent"><code>ALTER TABLE table_name DISABLE KEYS;</code></p>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>参数</th>
                        <th>作用</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>table_name</td>
                        <td>禁用索引的表的表名</td>
                    </tr>
                    </tbody>
                </table>
                <p class="firstLineIndent">重新开启索引的语句如下：</p>
                <p class="firstLineIndent"><code>ALTER TABLE table_name ENABLE KEYS;</code></p>
                <p class="firstLineIndent">对于空表批量导入数据，则不需要进行此操作，因为MyISAM引擎的表是在导入数据之后才建立索引的。</p>
            </div>
            <div id="optimize_database_structure_optimize_the_speed_of_inserting_records_1_2" class="tab-pane fade">
                <p class="fa fa-fire"> 禁用唯一性检查</p>
                <p class="firstLineIndent">
                    插入数据时，MySQL会对插入的记录进行唯一性校验。这种唯一性校验也会降低插入记录的速度。为了降低这种情况对查询速度的影响，可以在插入记录之前禁用唯一性检查，等到记录插入完毕后再开启。
                    禁用唯一性检查的语句如下：
                </p>
                <p class="firstLineIndent"><code>SET UNIQUE_CHECKS = 0;</code></p>
                <p class="firstLineIndent">开启唯一性检查的语句如下：</p>
                <p class="firstLineIndent"><code>SET UNIQUE_CHECKS = 1;</code></p>
            </div>
            <div id="optimize_database_structure_optimize_the_speed_of_inserting_records_1_3" class="tab-pane fade">
                <p class="fa fa-fire"> 使用批量插入</p>
                <p class="firstLineIndent">插入多条记录时，可以使用一条<code>INSERT</code>语句插入一条记录；也可以使用一条<code>INSERT</code>语句插入多条记录。插入一条记录的INSERT语句情形如下：</p>
                <pre>
                    <code class="sql">
    INSERT INTO fruits VALUES('x1','101','mongo2','5.7');
    INSERT INTO fruits VALUES('x2','101','mongo3','5.7');
    INSERT INTO fruits VALUES('x3','101','mongo4','5.7');
                    </code>
                </pre>
                <p class="firstLineIndent">使用一条INSERT语句插入多条记录的情形如下：</p>
                <pre>
                    <code class="sql">
    INSERT INTO fruits VALUES
    ('x1','101','mongo2','5.7'),
    ('x2','101','mongo3','5.7'),
    ('x3','101','mongo4','5.7');
                    </code>
                </pre>
                <p class="firstLineIndent">第2种情形的插入速度要比第1种情形快。</p>
            </div>
            <div id="optimize_database_structure_optimize_the_speed_of_inserting_records_1_4" class="tab-pane fade">
                <p class="fa fa-fire"> 使用LOAD DATA INFILE批量导入</p>
                <p class="firstLineIndent">当需要批量导入数据时，如果能用<code>LOAD DATA INFILE</code>语句，就尽量使用。因为<code>LOAD DATA INFILE</code>语句导入数据的速度比<code>INSERT</code>语句快。</p>
            </div>
            <div id="optimize_database_structure_optimize_the_speed_of_inserting_records_2_1" class="tab-pane fade">
                <p class="fa fa-fire"> 禁用唯一性检查</p>
                <p class="firstLineIndent">插入数据之前执行如下语句来禁止对唯一索引的检查：</p>
                <p class="firstLineIndent"><code>SET UNIQUE_CHECKS = 0;</code></p>
                <p class="firstLineIndent">数据导入完成之后再运行如下语句开启唯一性检查：</p>
                <p class="firstLineIndent"><code>SET UNIQUE_CHECKS = 1;</code></p>
                <p class="firstLineIndent">整体的步骤与MyISAM引擎的使用方法一样</p>
            </div>
            <div id="optimize_database_structure_optimize_the_speed_of_inserting_records_2_2" class="tab-pane fade">
                <p class="fa fa-fire"> 禁用外键检查</p>
                <p class="firstLineIndent">插入数据之前执行禁止对外键的检查，数据插入完成之后再恢复对外键的检查。禁用外键检查的语句如下：</p>
                <p class="firstLineIndent"><code>SET FOREIGN_KEY_CHECKS = 0;</code></p>
                <p class="firstLineIndent">恢复对外键的检查语句如下：</p>
                <p class="firstLineIndent"><code>SET FOREIGN_KEY_CHECKS = 1;</code></p>
            </div>
            <div id="optimize_database_structure_optimize_the_speed_of_inserting_records_2_3" class="tab-pane fade">
                <p class="fa fa-fire"> 禁止自动提交</p>
                <p class="firstLineIndent">插入数据之前禁止事务的自动提交，数据导入完成之后，执行恢复自动提交操作。禁止自动提交的语句如下：</p>
                <p class="firstLineIndent"><code>SET AUTOCOMMIT = 0;</code></p>
                <p class="firstLineIndent">恢复自动提交的语句如下：</p>
                <p class="firstLineIndent"><code>SET AUTOCOMMIT = 1;</code></p>
            </div>
        </div>
    </div>
</div>

<!-- 优化数据库结构-优化插入记录的速度提示 -->
<div id="optimize_database_structure_optimize_the_speed_of_inserting_records_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">优化插入记录的速度</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            插入记录时，影响插入速度的主要是索引、唯一性校验、一次插入记录条数等。根据这些情况，可以分别进行优化。
        </p>
    </div>
</div>

<!-- 优化数据库结构-分析表、检查表和优化表 -->
<div id="optimize_database_structure_analysis_table_check_table_and_optimization_table" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title tinyHand" onclick="optimizeDatabaseStructureAnalysisTableCheckTableAndOptimizationTableTips()">分析表、检查表和优化表 <i class="fa fa-hand-pointer-o"></i></h3>
    </div>
    <div class="panel-body">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#optimize_database_structure_analysis_table_check_table_and_optimization_table_1" data-toggle="tab">分析表</a></li>
            <li><a href="#optimize_database_structure_analysis_table_check_table_and_optimization_table_2" data-toggle="tab">检查表</a></li>
            <li><a href="#optimize_database_structure_analysis_table_check_table_and_optimization_table_3" data-toggle="tab">优化表</a></li>
        </ul>
        <div class="tab-content">
            <div id="optimize_database_structure_analysis_table_check_table_and_optimization_table_1" class="tab-pane fade in active">
                <p class="firstLineIndent">MySQL中提供了<code>ANALYZE TABLE</code>语句来分析表。ANALYZE TABLE语句的基本语法如下：</p>
                <p class="firstLineIndent"><code>ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tb1_name [,tb2_name]...</code></p>
                <hr>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>参数</th>
                        <th>作用</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>LOCAL</td>
                        <td>是NO_WRITE_TO_BINLOG关键字的别名，二者都是执行过程不写入二进制日志</td>
                    </tr>
                    <tr>
                        <td>tb1_name [,tb2_name]...</td>
                        <td>为分析表的表名，可以有一个或多个</td>
                    </tr>
                    </tbody>
                </table>
                <p class="firstLineIndent">
                    使用<code>ANALYZE TABLE</code>分析表的过程中，数据库系统会自动对表加一个只读锁。在分析期间，只能读取表中的记录，不能更新和插入记录。<code>ANALYZE TABLE</code>语句能够分析
                    <b>InnoDB</b>、<b>BDB</b>和<b>MyISAM</b>类型的表。
                </p>
                <hr>
                <h4><i class="fa fa-female"></i><b>示例：</b></h4>
                <p class="firstLineIndent">使用ANALYZE TABLE来分析message表，执行的语句及结果如下：</p>
                <pre>
                    <code class="sql">
    mysql> ANALYZE TABLE members;
    +-----------------+---------+----------+----------+
    |      Table      |   Op    | Msg_type | Msg_text |
    +-----------------+---------+----------+----------+
    | test_db.members | analyze |  status  |    OK    |
    +-----------------+---------+----------+----------+
    1 row in set (0.07 sec)
                    </code>
                </pre>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>参数</th>
                        <th>作用</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>Table</td>
                        <td>表示分析的表的名称</td>
                    </tr>
                    <tr>
                        <td>Op</td>
                        <td>表示执行的操作。analyze表示进行分析操作</td>
                    </tr>
                    <tr>
                        <td>Msg_type</td>
                        <td>表示信息类型，其值通常是状态（status）、信息（info）、注意（note）、警告（warning）和错误（error）之一</td>
                    </tr>
                    <tr>
                        <td>Msg_text</td>
                        <td>表示显示信息</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div id="optimize_database_structure_analysis_table_check_table_and_optimization_table_2" class="tab-pane fade">
                <p class="firstLineIndent">
                    MySQL中可以使用<code>CHECK TABLE</code>语句来检查表。<code>CHECK TABLE</code>语句能够检查<b>InnoDB</b>和<b>MyISAM</b>类型的表是否存在错误。对于<b>MyISAM</b>类型的表，
                    <code>CHECK TABLE</code>语句还会更新关键字统计数据。而且，<code>CHECK TABLE</code>也可以检查视图是否有错误，比如在视图定义中被引用的表已不存在。该语句的基本语法如下：
                </p>
                <p class="firstLineIndent"><code>CHECK TABLE tb1_name [,tb2_name]... [option] ...</code></p>
                <p class="firstLineIndent"><code>option = {QUICK | FAST | CHANGED | MEDIUM | EXTENDED}</code></p>
                <hr>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>参数</th>
                        <th>作用</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>tb1_name [,tb2_name]...</td>
                        <td>表示检查的表的名称</td>
                    </tr>
                    <tr>
                        <td>option</td>
                        <td>该参数有5个取值，分别是QUICK、FAST、CHANGED、MEDIUM、EXTENDED。该参数只对MyISAM类型的表有效，对InnoDB类型的表无效。</td>
                    </tr>
                    </tbody>
                </table>
                <hr>
                <p class="firstLineIndent"><b>option</b>的各个选项的意义如下：</p>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>参数</th>
                        <th>作用</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>QUICK</td>
                        <td>不扫描行，不检查错误的连接</td>
                    </tr>
                    <tr>
                        <td>FAST</td>
                        <td>只检查没有被正确关闭的表</td>
                    </tr>
                    <tr>
                        <td>CHANGED</td>
                        <td>只检查上次检查后被更改的表和没有被正确关闭的表</td>
                    </tr>
                    <tr>
                        <td>MEDIUM</td>
                        <td>扫描行，以验证被删除的连接是有效的。也可以计算各行的关键字校验和，并使用计算出的校验和验证这一点</td>
                    </tr>
                    <tr>
                        <td>EXTENDED</td>
                        <td>对每行的所有关键字进行一个全面的关键字查找。这可以确保表100%一致的，但是花的时间较长</td>
                    </tr>
                    </tbody>
                </table>
                <p class="firstLineIndent"><code>CHECK TABLE</code>语句在执行过程中也会给表加上只读锁。</p>
            </div>
            <div id="optimize_database_structure_analysis_table_check_table_and_optimization_table_3" class="tab-pane fade">
                <p class="firstLineIndent">
                    MySQL中使用<code>OPTIMIZE TABLE</code>语句来优化表。该语句对<b>InnoDB</b>和<code>MyISAM</code>类型的表都有效。但是，<code>OPTIMIZE TABLE</code>语句只能优化表中
                    VARCHAR、BLOB或TEXT类型的字段。OPTIMIZE TABLE语句的基本语法如下：
                </p>
                <p class="firstLineIndent"><code>OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tb1_name[,tb2_name]...</code></p>
                <hr>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>参数</th>
                        <th>作用</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>LOCAL</td>
                        <td>是NO_WRITE_TO_BINLOG关键字的别名，二者都是执行过程不写入二进制日志</td>
                    </tr>
                    <tr>
                        <td>tb1_name [,tb2_name]...</td>
                        <td>为分析表的表名，可以有一个或多个</td>
                    </tr>
                    </tbody>
                </table>
                <p class="firstLineIndent">通过<code>OPTIMIZE TABLE</code>语句可以消除删除和更新造成的碎片文件。<code>OPTIMIZE TABLE</code>语句在执行过程中也会给表加上只读锁。</p>
                <p class="firstLineIndent">
                    <span class="note">注意</span>：一个表使用了<code>TEXT</code>或者<code>BLOB</code>这样的数据类型，如果已经删除了表的一大部分，或者已经对含有可变长度行的表（含有
                    <code>VARCHAR</code>、<code>BLOB</code>或<code>TEXT</code>列的表）进行了很多更新，则应使用<code>OPTIMIZE TABLE</code>来重新利用未使用的空间，并整理数据文件
                    的碎片。在多数的设置中，根本不需要运行<code>OPTIMIZE TABLE</code>。即使对可变长度的行进行了大量的更新，也不需要经常运行，每周一次或每月一次即可，并且只需要对特定的表运行。
                </p>
            </div>
        </div>
    </div>
</div>

<!-- 优化数据库结构-分析表、检查表和优化表提示 -->
<div id="optimize_database_structure_analysis_table_check_table_and_optimization_table_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">分析表、检查表和优化表</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">MySQL提供了分析表、检查表和优化表的语句。分析表主要是分析关键字的分布；检查表主要是检查表中是否存在错误；优化表主要是消除删除或者更新造成的空间浪费。</p>
    </div>
</div>

<!-- 优化MySQL服务器提示 -->
<div id="optimize_mysql_server_tips" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">优化MySQL服务器</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            优化MySQL服务器主要从两方面来优化：一方面是对硬件进行优化；另一方面是对MySQL服务的参数进行优化。这部分的内容需要较全面的知识，一般只有专业的数据库管理员才能进行这一类的优化。对于可以定制
            参数的操作系统，也可以针对MySQL进行操作系统优化。
        </p>
    </div>
</div>

<!-- 优化MySQL服务器-优化服务器硬件 -->
<div id="optimize_mysql_server_optimize_server_hardware" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">优化服务器硬件</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">服务器的硬件性能直接决定着MySQL数据库的性能。硬件的性能瓶颈直接决定MySQL数据库的运行速度和效率。针对性能瓶颈，提高硬件配置，可以提高MySQL数据库查询、更新的速度。</p>
        <ol>
            <li>配置较大的内存。足够大的内存是提高MySQL数据库性能的方法之一。内存的速度比磁盘I/O快得多，可以通过增加系统的缓冲区容量使数据在内存停留的时间更长，以减少磁盘I/O</li>
            <li>配置高速磁盘系统，以减少读盘的等待时间，提高响应速度</li>
            <li>合理分布磁盘I/O，把磁盘I/O分散在多个设备上，以减少资源竞争，提高并行操作能力</li>
            <li>配置多处理器。MySQL是多线程的数据库，多处理器可同时执行多个线程</li>
        </ol>
    </div>
</div>

<!-- 优化MySQL服务器-优化MySQL的参数 -->
<div id="optimize_mysql_server_optimize_mysql_parameters" class="panel" style="display: none">
    <div class="panel-heading">
        <h3 class="panel-title">优化MySQL的参数</h3>
    </div>
    <div class="panel-body">
        <p class="firstLineIndent">
            通过优化MySQL的参数可以提高资源利用率，从而达到提高MySQL服务器性能的目的。MySQL服务的配置参数都在<span class="bold note">my.cnf</span>或者<span class="bold note">my.ini</span>
            文件的<span>[mysqld]</span>组中。下面针对几个对性能影响比较大的参数进行详细的介绍：
        </p>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>参数</th>
                <th>作用</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>key_buffer_size</td>
                <td>
                    表示索引缓冲区的大小。索引缓冲区所有的线程共享。增加索引缓冲区可以得到更好处理的索引（对所有读和多重写）。当然，这个值也不是越大越好，它的大小取决于内存的大小。如果这个值太大，
                    导致操作系统频繁换页，也会降低系统性能
                </td>
            </tr>
            <tr>
                <td>table_cache</td>
                <td>
                    表示同时打开的表的个数。这个值越大，能够同时打开的表的个数越多。这个值不是越大越好，因为同时打开的表太多会影响操作系统的性能
                </td>
            </tr>
            <tr>
                <td>query_cache_size</td>
                <td>
                    表示查询缓冲区的大小。该参数需要和<code>query_cache_type</code>配合使用。
                    <ul>
                        <li>当<code>query_cache_type=0</code>时，所有的查询都不使用查询缓冲区。但是这并不会导致MySQL释放<code>query_cache_size</code>所配置的缓冲区内存</li>
                        <li>当<code>query_cache_type=1</code>时，所有的查询都将使用查询缓冲区，除非在查询语句中指定<b>SQL_NO_CACHE</b>，如SELECT SQL_NO_CACHE * FROM tb1_name</li>
                        <li>当<code>query_cache_type=2</code>时，只有在查询语句中使用<b>SQL_CACHE</b>关键字，查询才会使用查询缓冲区</li>
                    </ul>
                    使用查询缓冲区可以提高查询的速度，这种方式只适用于修改操作少且经常执行相同的查询操作的情况
                </td>
            </tr>
            <tr>
                <td>sort_buffer_size</td>
                <td>表示每个需要进行排序的线程分配的缓冲区的大小。增加这个参数的值可以提高<code>ORDER BY</code>或<code>GROUP BY</code>操作的速度，默认数值是2097144字节（约2MB）</td>
            </tr>
            <tr>
                <td>read_buffer_size</td>
                <td>
                    表示每个线程连续扫描时为扫描的每个表分配的缓冲区的大小（字节）。当线程从表中连续读取记录时需要用到这个缓冲区。<br/>
                    <code>SET SESSION read_buffer_size = n;</code>可以临时设置该参数的值
                </td>
            </tr>
            <tr>
                <td>read_rnd_buffer_size</td>
                <td>
                    表示为每个线程保留的缓冲区的大小，与<code>read_buffer_size</code>相似。但主要用于存储按特定顺序读取出来的记录。也可以用<br/>
                    <code>SET SESSION read_rnd_buffer_size = n;</code>来临时设置该参数的值。如果频繁进行多次连续扫描，可以增加该值
                </td>
            </tr>
            <tr>
                <td>innodb_buffer_pool_size</td>
                <td>表示InnoDB类型的表和索引的最大缓存。这个值越大，查询的速度就会越快，但是这个值太大会影响操作系统的性能</td>
            </tr>
            <tr>
                <td>max_connections</td>
                <td>表示数据库的最大连接数。这个连接数不是越大越好，因为这些连接会浪费内存资源。过多的连接可能会导致MySQL服务器僵死</td>
            </tr>
            <tr>
                <td>innodb_flush_log_at_trx_commit</td>
                <td>
                    表示何时将缓冲区的数据写入日志文件，并且将日志文件写入磁盘中。该参数对于InnoDB引擎非常重要。该参数有3个值，分别为0、1和2。
                    <ul>
                        <li>值为0时，表示每隔1秒将数据写入日志文件并将日志文件写入磁盘</li>
                        <li>值为1时，表示每次提交事务时将数据写入日志文件并将日志文件写入磁盘</li>
                        <li>值为2时，表示每次提交事务时将数据写入日志文件，每隔1秒将日志文件写入磁盘</li>
                    </ul>
                    该参数的默认值为1.默认值1安全性最高，但是每次事务提交或事务外的指令都需要把日志写入（flush）磁盘，是比较费时的；0值更快一点，但安全方面比较差；2值日志仍然会每秒写入到硬盘，所以即使
                    出现故障，一般也不会丢失超过1~2秒的更新
                </td>
            </tr>
            <tr>
                <td>back_log</td>
                <td>
                    表示在MySQL暂时停止回答新请求之前的短时间内，多少个请求可以被存在堆栈中。换句话说，该值表示对到来的TCP/IP连接的侦听队列的大小。只有期望在一个短时间内有很多连接时才需要增加该参数的值。
                    操作系统在这个队列大小上也有限制，设定back_log高于操作系统的限制将是无效的
                </td>
            </tr>
            <tr>
                <td>interactive_timeout</td>
                <td>表示服务器在关闭连接前等待行动的秒数</td>
            </tr>
            <tr>
                <td>thread_cache_size</td>
                <td>表示可以复用的线程的数量。如果有很多新的线程，为了提高性能可以增大该参数的值</td>
            </tr>
            <tr>
                <td>wait_timeout</td>
                <td>表示服务器在关闭一个连接时等待行动的秒数，默认数值是28800（8h）</td>
            </tr>
            </tbody>
        </table>
        <p class="firstLineIndent">
            合理的配置这些参数可以提高MySQL服务器的性能。除了上述参数以外，还有<code>innodb_log_buffer_size</code>、<code>innodb_log_file_size</code>等参数。配置完参数以后，需要
            重新启动MySQL服务才会生效。
        </p>
    </div>
</div>

<!-- CUSTOM JAVASCRIPT -->
<script type="text/javascript" src="../../../assets/scripts/common-method.js"></script>
<script type="text/javascript" src="../../../assets/scripts/base.js"></script>
<script type="text/javascript" src="../../../assets/scripts/responseStatusCode.js"></script>
<script type="text/javascript" src="../../../assets/scripts/mysql/mysql-high-level-knowledge/mysql-high-level-knowledge-mysql-log-and-performance-optimization.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>

</html>
